import{a9 as C,j as e,o as g,aa as P,ab as Z,U as Y,ac as X,ad as J,ae as Q,r as h,af as ee,ag as se,ah as te,ai as ae,aj as re,ak as ie,X as ne,g as E,al as k,am as le,an as I,ao as oe,f as R,ap as ce,aq as de,ar as me,as as M,at as xe,au as ue,av as B,aw as he,ax as pe,Z as fe,b as $,ay as O,az as ge,aA as G,aB as _,aC as H,aD as je,aE as be,aF as ye,aG as Ne,aH as ve,aI as we,z as Se,y as Ce,aJ as ke,aK as L,aL as Ae,aM as De,aN as Te,aO as Fe,aP as ze,aQ as Ee,aR as We,aS as Ie,aT as Le}from"./vendor-BJtIU4cE.js";import{B as N}from"./button-ZZWTDpQH.js";import{u as v,c as x,a as Pe,e as Re,A as Me}from"./index-DT2D_i0V.js";import{S as Be,N as $e}from"./Navigation-CchaNxGk.js";import{B as K,D as Oe,b as Ge,c as _e,d as He,e as Ke,f as Ve,g as Ue}from"./dialog-B7IIvyeJ.js";import{T as qe}from"./ThreatIntelCard-uScfWQHb.js";import{P as Ze}from"./PersistenceDiagram-BolSaJQU.js";import{C as A,a as D,b as T,d as F}from"./card-CjP5KoZO.js";const Ye=C.forwardRef(({event:s,index:r},n)=>{const a=s.delta&&s.delta>0?"text-success":s.delta&&s.delta<0?"text-critical":"text-muted-foreground",l=i=>{if(!i)return null;const d=i>0?"+":"";return Math.abs(i)>=1e3?`${d}${(i/1e3).toFixed(1)}K`:`${d}${i}`},t=()=>s.type==="new"?e.jsx(X,{className:"w-3 h-3"}):s.type==="categorize"?e.jsx(J,{className:"w-3 h-3"}):e.jsx(Q,{className:"w-3 h-3"});return e.jsx(g.div,{ref:n,initial:{opacity:0,x:-20,height:0},animate:{opacity:1,x:0,height:"auto"},exit:{opacity:0,x:20,height:0},transition:{duration:.2,delay:r*.02},className:"border-b border-border/30 py-2 px-1 last:border-0",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("div",{className:x("p-1 rounded mt-0.5",s.type==="new"?"bg-success/10 text-success":"bg-primary/10 text-primary"),children:t()}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-1.5 mb-0.5",children:[e.jsx("span",{className:"text-xs font-medium truncate max-w-[180px]",title:s.title,children:s.title}),s.minor&&e.jsx(K,{variant:"outline",className:"text-[8px] px-1 py-0",children:"m"})]}),e.jsxs("div",{className:"flex items-center gap-2 text-[10px] text-muted-foreground",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[s.bot?e.jsx(Z,{className:"w-3 h-3"}):e.jsx(Y,{className:"w-3 h-3"}),e.jsx("span",{className:"truncate max-w-[80px]",title:s.user,children:s.user})]}),e.jsx("span",{className:"opacity-50",children:"•"}),e.jsx("span",{className:"font-mono opacity-70",children:s.wiki.replace("wiki","")}),s.delta!==void 0&&s.delta!==0&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"opacity-50",children:"•"}),e.jsx("span",{className:x("font-mono font-medium",a),children:l(s.delta)})]})]})]}),e.jsx("span",{className:"text-[9px] text-muted-foreground shrink-0",children:s.timestamp.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",second:"2-digit"})})]})})});function Xe({className:s,maxItems:r=15}){const{events:n,isConnected:a,eventsPerSecond:l}=v(),[t,i]=C.useState([]),[d,p]=C.useState("all");C.useEffect(()=>{n.length>0&&i(c=>[...n,...c].slice(0,50))},[n]);const o=t.filter(c=>d==="all"?!0:d==="bot"?c.bot:d==="user"?!c.bot:!0).slice(0,r);return e.jsxs("div",{className:x("relative h-full flex flex-col",s),children:[e.jsxs("div",{className:"flex items-center justify-between mb-2 px-1 shrink-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm font-medium",children:"Live Feed"}),a&&e.jsxs(g.div,{className:"flex items-center gap-1 px-1.5 py-0.5 rounded-full bg-success/10 text-success text-[9px]",animate:{opacity:[.7,1,.7]},transition:{duration:2,repeat:1/0},children:[e.jsx("span",{className:"w-1.5 h-1.5 rounded-full bg-success"}),l,"/s"]})]}),e.jsxs("div",{className:"flex items-center gap-1 bg-slate-800/50 rounded-lg p-0.5",children:[e.jsx("button",{onClick:()=>p("all"),className:x("px-2 py-0.5 text-[10px] rounded transition-colors",d==="all"?"bg-primary/20 text-primary":"text-muted-foreground hover:text-foreground"),children:"All"}),e.jsx("button",{onClick:()=>p("user"),className:x("px-2 py-0.5 text-[10px] rounded transition-colors",d==="user"?"bg-primary/20 text-primary":"text-muted-foreground hover:text-foreground"),children:"User"}),e.jsx("button",{onClick:()=>p("bot"),className:x("px-2 py-0.5 text-[10px] rounded transition-colors",d==="bot"?"bg-primary/20 text-primary":"text-muted-foreground hover:text-foreground"),children:"Bot"})]})]}),e.jsx(Be,{className:"flex-1 pr-2 -mr-2",children:e.jsx("div",{className:"pr-2",children:e.jsx(P,{mode:"popLayout",initial:!1,children:o.length>0?o.map((c,f)=>e.jsx(Ye,{event:c,index:f},c.id)):e.jsx(g.div,{initial:{opacity:0},animate:{opacity:1},className:"py-8 text-center text-muted-foreground",children:e.jsx("p",{className:"text-xs",children:a?"Waiting for events...":"Connect to see live edits"})})})})}),a&&o.length>0&&e.jsxs("div",{className:"mt-2 pt-2 border-t border-border/30 flex items-center justify-between text-[10px] text-muted-foreground shrink-0",children:[e.jsxs("span",{children:[o.filter(c=>c.bot).length," bot edits"]}),e.jsxs("span",{children:[o.filter(c=>c.type==="new").length," new articles"]})]})]})}function Je({className:s}){var p;const{timeline:r,isConnected:n}=v(),a=h.useMemo(()=>r.length>0?r:Array.from({length:24},(m,o)=>({time:`${String(o).padStart(2,"0")}:00`,timestamp:new Date,value:.1+Math.random()*.1,anomaly:!1,eventCount:0})),[r]),l=Math.max(...a.map(m=>m.value),.1),t=100/(a.length-1),i=a.map((m,o)=>{const c=o*t,f=100-m.value/l*80;return`${o===0?"M":"L"} ${c} ${f}`}).join(" "),d=`${i} L 100 100 L 0 100 Z`;return e.jsxs("div",{className:x("relative bg-card/50 rounded-xl p-4 border border-border/50",s),children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm font-medium text-foreground",children:"Anomaly Timeline"}),n&&e.jsxs(g.div,{className:"flex items-center gap-1 px-2 py-0.5 rounded-full bg-success/10 text-success text-[10px]",animate:{opacity:[.7,1,.7]},transition:{duration:2,repeat:1/0},children:[e.jsx("span",{className:"w-1.5 h-1.5 rounded-full bg-success"}),"Live"]})]}),e.jsxs("div",{className:"flex gap-3 text-xs",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-anomaly"}),e.jsx("span",{className:"text-muted-foreground",children:"Warning"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-critical"}),e.jsx("span",{className:"text-muted-foreground",children:"Critical"})]})]})]}),e.jsxs("svg",{className:"w-full h-32",viewBox:"0 0 100 100",preserveAspectRatio:"none",children:[e.jsxs("defs",{children:[e.jsxs("linearGradient",{id:"areaGradient",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"0%",stopColor:"hsl(var(--primary))",stopOpacity:"0.3"}),e.jsx("stop",{offset:"100%",stopColor:"hsl(var(--primary))",stopOpacity:"0"})]}),e.jsxs("linearGradient",{id:"lineGradient",x1:"0",y1:"0",x2:"1",y2:"0",children:[e.jsx("stop",{offset:"0%",stopColor:"hsl(var(--primary))"}),e.jsx("stop",{offset:"50%",stopColor:"hsl(var(--primary-glow))"}),e.jsx("stop",{offset:"100%",stopColor:"hsl(var(--primary))"})]})]}),e.jsx("g",{opacity:"0.1",children:[25,50,75].map(m=>e.jsx("line",{x1:"0",y1:m,x2:"100",y2:m,stroke:"hsl(var(--foreground))",strokeWidth:"0.5"},m))}),e.jsx(g.path,{d,fill:"url(#areaGradient)",initial:{opacity:0},animate:{opacity:1},transition:{duration:1}}),e.jsx(g.path,{d:i,fill:"none",stroke:"url(#lineGradient)",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",initial:{pathLength:0},animate:{pathLength:1},transition:{duration:2,ease:"easeOut"}}),a.map((m,o)=>{if(!m.anomaly)return null;const c=o*t,f=100-m.value/l*80,w="severity"in m&&m.severity==="critical";return e.jsxs(g.g,{children:[e.jsx(g.circle,{cx:c||0,cy:f||0,r:"8",fill:w?"hsl(var(--critical))":"hsl(var(--anomaly))",opacity:"0.3",animate:{r:[8,15,8],opacity:[.3,0,.3]},transition:{duration:2,repeat:1/0}}),e.jsx(g.circle,{cx:c||0,cy:f||0,r:"4",fill:w?"hsl(var(--critical))":"hsl(var(--anomaly))",initial:{scale:0},animate:{scale:1},transition:{delay:o*.05+.5,type:"spring"}})]},o)}),a.length>0&&e.jsx(g.circle,{cx:100,cy:100-a[a.length-1].value/l*80,r:"4",fill:"hsl(var(--primary))",animate:{r:[4,6,4],opacity:[1,.7,1]},transition:{duration:1.5,repeat:1/0}})]}),e.jsx("div",{className:"flex justify-between mt-2 text-[10px] text-muted-foreground",children:a.filter((m,o)=>o%Math.max(1,Math.floor(a.length/6))===0).map((m,o)=>e.jsx("span",{children:m.time},o))}),n&&r.length>0&&e.jsxs("div",{className:"absolute bottom-4 right-4 text-[10px] text-muted-foreground bg-card/80 px-2 py-1 rounded",children:[((p=r[r.length-1])==null?void 0:p.eventCount)||0," events/interval"]})]})}function Qe({id:s,title:r,children:n,onRemove:a,className:l}){const{attributes:t,listeners:i,setNodeRef:d,transform:p,transition:m,isDragging:o}=ee({id:s}),[c,f]=C.useState(!1),[w,z]=C.useState(!1),u={transform:se.Transform.toString(p),transition:m,zIndex:o||c?50:"auto",position:c?"fixed":"relative",top:c?0:"auto",left:c?0:"auto",right:c?0:"auto",bottom:c?0:"auto",width:c?"100vw":"auto",height:c?"100vh":"100%"},j=()=>{z(!0),setTimeout(()=>z(!1),1e3)},S=s==="feed"?"live-feed":s==="topology"?"topology-viz":void 0;return e.jsx("div",{ref:d,style:u,className:x("h-full",l,c&&"z-[100] p-4 bg-background/80 backdrop-blur-sm"),"data-tour":S,children:e.jsxs(A,{className:x("h-full flex flex-col overflow-hidden transition-all duration-200 glass-card",o&&"shadow-2xl ring-2 ring-primary/50 opacity-80 rotate-1",c&&"border-primary/20 shadow-2xl"),children:[e.jsxs(D,{className:"flex flex-row items-center justify-between space-y-0 pb-2 p-4 border-b border-slate-800/50",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[!c&&e.jsx("div",{...t,...i,className:"cursor-grab active:cursor-grabbing p-1 hover:bg-slate-800 rounded transition-colors",children:e.jsx(te,{className:"w-4 h-4 text-slate-500"})}),e.jsxs(T,{className:"text-sm font-medium text-slate-200 flex items-center gap-2",children:[r,w&&e.jsx("span",{className:"text-xs text-muted-foreground animate-pulse",children:"Refreshing..."})]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(N,{variant:"ghost",size:"icon",className:x("h-6 w-6 text-slate-500 hover:text-primary",w&&"animate-spin text-primary"),onClick:j,children:e.jsx(ae,{className:"w-3 h-3"})}),e.jsx(N,{variant:"ghost",size:"icon",className:"h-6 w-6 text-slate-500 hover:text-primary",onClick:()=>f(!c),children:c?e.jsx(re,{className:"w-3 h-3"}):e.jsx(ie,{className:"w-3 h-3"})}),a&&!c&&e.jsx(N,{variant:"ghost",size:"icon",className:"h-6 w-6 text-slate-500 hover:text-red-400 hover:bg-red-500/10",onClick:()=>a(s),children:e.jsx(ne,{className:"w-3 h-3"})})]})]}),e.jsx(F,{className:"flex-1 p-0 h-[calc(100%-60px)] relative overflow-hidden",children:n})]})})}const V=[{id:"feed",title:"Live Event Feed",description:"Real-time stream of Wikipedia edits and anomalies.",icon:E,defaultSize:"medium"},{id:"anomaly-score",title:"Anomaly Score",description:"Real-time unified anomaly score with topological breakdown.",icon:k,defaultSize:"medium"},{id:"timeline",title:"Anomaly Timeline",description:"Historical view of detected anomalies over time.",icon:le,defaultSize:"large"},{id:"landscape",title:"Persistence Landscape",description:"Functional representation of topological features (H1).",icon:I,defaultSize:"medium"},{id:"threats",title:"Threat Intelligence",description:"Latest threat indicators and C2 server detections.",icon:k,defaultSize:"medium"},{id:"topology",title:"Persistence Diagram",description:"Topological data analysis visualization.",icon:oe,defaultSize:"medium"},{id:"tda-stats",title:"Advanced TDA Metrics",description:"Wasserstein distance, landscapes, and multi-modal anomaly scores.",icon:R,defaultSize:"medium"},{id:"barcode",title:"Persistence Barcode",description:"Interactive barcode showing feature lifetimes.",icon:ce,defaultSize:"large"},{id:"birth-death",title:"Birth-Death Plane",description:"Scatter plot of topological features.",icon:de,defaultSize:"medium"},{id:"filtration",title:"Filtration Animation",description:"Visual timeline of the filtration process.",icon:me,defaultSize:"medium"}];function es({open:s,onOpenChange:r,onAddWidget:n,activeWidgets:a}){return e.jsx(Oe,{open:s,onOpenChange:r,children:e.jsxs(Ge,{className:"sm:max-w-[500px] bg-slate-900 border-slate-800 text-slate-200",children:[e.jsxs(_e,{children:[e.jsx(He,{children:"Add Widget"}),e.jsx(Ke,{className:"text-slate-400",children:"Choose a widget to add to your dashboard."})]}),e.jsx("div",{className:"grid gap-4 py-4",children:V.map(l=>{const t=a.includes(l.id);return e.jsxs("div",{className:x("flex items-start gap-4 p-3 rounded-lg border transition-all",t?"border-slate-800 bg-slate-800/50 opacity-50 cursor-not-allowed":"border-slate-700 bg-slate-800/30 hover:bg-slate-800 hover:border-primary/50 cursor-pointer"),onClick:()=>!t&&n(l.id),children:[e.jsx("div",{className:x("p-2 rounded-md",t?"bg-slate-700":"bg-primary/10 text-primary"),children:e.jsx(l.icon,{className:"w-5 h-5"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"text-sm font-medium leading-none mb-1.5",children:l.title}),e.jsx("p",{className:"text-xs text-slate-400 leading-snug",children:l.description})]}),!t&&e.jsx(N,{size:"icon",variant:"ghost",className:"h-8 w-8 text-primary",children:e.jsx(M,{className:"w-4 h-4"})})]},l.id)})}),e.jsx(Ve,{children:e.jsx(Ue,{asChild:!0,children:e.jsx(N,{variant:"ghost",children:"Cancel"})})})]})})}function b({className:s,...r}){return e.jsx("div",{className:x("animate-pulse rounded-md bg-muted",s),...r})}function ss(){return e.jsxs("div",{className:"p-4 space-y-4 h-full",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx(b,{className:"h-12 w-12 rounded-full bg-slate-800"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(b,{className:"h-4 w-[250px] bg-slate-800"}),e.jsx(b,{className:"h-4 w-[200px] bg-slate-800"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(b,{className:"h-4 w-full bg-slate-800"}),e.jsx(b,{className:"h-4 w-full bg-slate-800"}),e.jsx(b,{className:"h-4 w-3/4 bg-slate-800"})]}),e.jsxs("div",{className:"pt-4 grid grid-cols-3 gap-4",children:[e.jsx(b,{className:"h-20 w-full bg-slate-800"}),e.jsx(b,{className:"h-20 w-full bg-slate-800"}),e.jsx(b,{className:"h-20 w-full bg-slate-800"})]})]})}function ts(){const[s,r]=h.useState(!1);h.useEffect(()=>{if(localStorage.getItem("toposhape_tour_seen"))r(!0);else{const l=setTimeout(()=>{n()},2e3);return()=>clearTimeout(l)}},[]);const n=()=>{const a=xe({showProgress:!0,animate:!0,steps:[{element:"nav",popover:{title:"Welcome to TopoShape Insights",description:"Your advanced platform for topological data analysis and anomaly detection.",side:"right",align:"start"}},{element:'[data-tour="dashboard-widgets"]',popover:{title:"Interactive Dashboard",description:'Drag and drop widgets to customize your view. Click the "Add Widget" button to add more.',side:"bottom",align:"start"}},{element:'[data-tour="theme-toggle"]',popover:{title:"Theme & Customization",description:"Switch between Dark and Light modes here. Use Cmd+K to open the Command Palette for quick actions.",side:"bottom",align:"end"}},{element:'[data-tour="live-feed"]',popover:{title:"Real-time Feed",description:"Watch live events stream in. TDA algorithms process these in real-time to detect anomalies.",side:"left",align:"start"}},{element:'[data-tour="topology-viz"]',popover:{title:"Topological Analysis",description:"Visualize persistence diagrams and Betti numbers to understand the shape of your data.",side:"left",align:"start"}}],onDestroyStarted:()=>{(!a.hasNextStep()||confirm("Are you sure you want to stop the tour?"))&&(a.destroy(),localStorage.setItem("toposhape_tour_seen","true"),r(!0))}});a.drive()};return e.jsx(N,{variant:"ghost",size:"icon",className:"fixed bottom-4 right-4 z-50 rounded-full w-10 h-10 bg-primary/10 text-primary hover:bg-primary/20 shadow-lg backdrop-blur-sm border border-primary/20",onClick:n,title:"Start Tour",children:e.jsx(ue,{className:"w-5 h-5"})})}function as(s){const[r,n]=h.useState(null),a=h.useRef(null),l=h.useRef(0),t=h.useRef(!1);return h.useEffect(()=>(a.current=new Worker(new URL("/WINTER-2026/assets/tda.worker-1-1pGS40.js",import.meta.url),{type:"module"}),a.current.onmessage=i=>{const{type:d,payload:p}=i.data;d==="RESULT"?(n(p),t.current=!1):d==="ERROR"&&(console.error("TDA Worker Error:",p.message),t.current=!1)},a.current.postMessage({type:"INIT",payload:{windowSize:50}}),()=>{var i;(i=a.current)==null||i.terminate()}),[]),h.useEffect(()=>{var d;const i=Date.now();i-l.current<2e3||t.current||s.length<10||(t.current=!0,l.current=i,(d=a.current)==null||d.postMessage({type:"ANALYZE",payload:{events:s,windowMs:3e4}}))},[s]),r}const y=h.forwardRef(({className:s,value:r,indicatorClassName:n,...a},l)=>e.jsx(B,{ref:l,className:x("relative h-4 w-full overflow-hidden rounded-full bg-secondary",s),...a,children:e.jsx(he,{className:x("h-full w-full flex-1 bg-primary transition-all",n),style:{transform:`translateX(-${100-(r||0)}%)`}})}));y.displayName=B.displayName;function rs(){const{events:s}=v(),r=as(s);if(!r)return e.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-muted-foreground space-y-2",children:[e.jsx(E,{className:"w-8 h-8 animate-pulse text-primary/50"}),e.jsx("p",{className:"text-sm",children:"Initializing TDA Engine..."})]});const{score:n,processingTime:a}=r,l=n.isAnomaly;return e.jsxs("div",{className:"p-4 space-y-6 h-full overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[l?e.jsx(k,{className:"w-5 h-5 text-red-500 animate-pulse"}):e.jsx(pe,{className:"w-5 h-5 text-green-500"}),e.jsx("span",{className:"font-medium text-sm",children:"System Status"})]}),e.jsx(K,{variant:l?"destructive":"outline",className:x(l?"animate-pulse":"bg-green-500/10 text-green-500 border-green-500/20"),children:l?"ANOMALY DETECTED":"STABLE"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-xs",children:[e.jsxs("span",{className:"text-muted-foreground flex items-center gap-1",children:[e.jsx(E,{className:"w-3 h-3"})," Wasserstein Distance"]}),e.jsx("span",{className:"font-mono",children:n.components.wasserstein.toFixed(2)})]}),e.jsx(y,{value:Math.min(n.components.wasserstein*10,100),className:"h-1.5"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-xs",children:[e.jsxs("span",{className:"text-muted-foreground flex items-center gap-1",children:[e.jsx(R,{className:"w-3 h-3"})," Landscape Norm (Z-Score)"]}),e.jsx("span",{className:"font-mono",children:n.components.landscape.toFixed(2)})]}),e.jsx(y,{value:Math.min(n.components.landscape*20,100),className:"h-1.5"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-xs",children:[e.jsx("span",{className:"text-muted-foreground",children:"Combined Anomaly Score"}),e.jsx("span",{className:x("font-mono font-bold",n.totalScore>3?"text-red-400":"text-green-400"),children:n.totalScore.toFixed(2)})]}),e.jsx(y,{value:Math.min(n.totalScore*20,100),className:x("h-2",n.totalScore>3?"bg-red-900/20":"bg-green-900/20")})]})]}),e.jsxs("div",{className:"pt-4 border-t border-border/50 grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"bg-muted/30 p-3 rounded-lg",children:[e.jsx("p",{className:"text-xs text-muted-foreground mb-1",children:"Confidence"}),e.jsxs("p",{className:"text-lg font-bold text-primary",children:[(n.confidence*100).toFixed(0),"%"]})]}),e.jsxs("div",{className:"bg-muted/30 p-3 rounded-lg",children:[e.jsxs("p",{className:"text-xs text-muted-foreground mb-1 flex items-center gap-1",children:[e.jsx(fe,{className:"w-3 h-3"})," Latency"]}),e.jsxs("p",{className:"text-lg font-bold font-mono",children:[a.toFixed(1),"ms"]})]})]})]})}function is({data:s,height:r=300}){const{theme:n}=$(),a=h.useMemo(()=>s.map((t,i)=>({...t,index:i,lifetime:t.death-t.birth})).sort((t,i)=>i.death-i.birth-(t.death-t.birth)),[s]);a.filter(t=>t.dimension===0),a.filter(t=>t.dimension===1),a.filter(t=>t.dimension===2);const l=Math.max(...s.map(t=>t.death),1);return e.jsxs("div",{className:"w-full h-full min-h-[300px] flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2 px-2",children:[e.jsx("h3",{className:"text-sm font-medium",children:"Persistence Barcode"}),e.jsxs("div",{className:"flex gap-2 text-xs",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"w-2 h-2 rounded-full bg-blue-500"})," H0"]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"w-2 h-2 rounded-full bg-green-500"})," H1"]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"w-2 h-2 rounded-full bg-orange-500"})," H2"]})]})]}),e.jsxs("div",{className:"flex-1 relative border-l border-b border-border/50 m-2",children:[e.jsx("svg",{width:"100%",height:"100%",className:"overflow-visible",children:a.map((t,i)=>{const d=i/a.length*100+"%",p=t.birth/l*100+"%",m=t.death/l*100+"%",o=t.dimension===0?"#3b82f6":t.dimension===1?"#22c55e":"#f97316";return e.jsxs("g",{className:"group cursor-pointer",children:[e.jsx("line",{x1:p,y1:d,x2:m,y2:d,stroke:o,strokeWidth:"4",strokeLinecap:"round",className:"opacity-70 group-hover:opacity-100 group-hover:stroke-[6px] transition-all"}),e.jsx("title",{children:`Dim ${t.dimension}: [${t.birth.toFixed(2)}, ${t.death.toFixed(2)}]`})]},t.id)})}),e.jsxs("div",{className:"absolute -bottom-6 left-0 right-0 flex justify-between text-xs text-muted-foreground",children:[e.jsx("span",{children:"0"}),e.jsx("span",{children:"Time →"}),e.jsx("span",{children:l.toFixed(1)})]})]})]})}function ns({data:s}){const{theme:r}=$(),n=r==="dark",a=({active:l,payload:t})=>{if(l&&t&&t.length){const i=t[0].payload;return e.jsxs("div",{className:"bg-background/90 backdrop-blur border border-border p-2 rounded shadow-lg text-xs",children:[e.jsxs("p",{className:"font-bold mb-1",children:["Feature ",i.id]}),e.jsxs("p",{children:["Dimension: H",i.dimension]}),e.jsxs("p",{children:["Birth: ",i.birth.toFixed(3)]}),e.jsxs("p",{children:["Death: ",i.death.toFixed(3)]}),e.jsxs("p",{children:["Persistence: ",(i.death-i.birth).toFixed(3)]})]})}return null};return e.jsxs("div",{className:"w-full h-full min-h-[300px] flex flex-col",children:[e.jsx("div",{className:"flex items-center justify-between mb-2 px-2",children:e.jsx("h3",{className:"text-sm font-medium",children:"Birth-Death Plane"})}),e.jsx("div",{className:"flex-1",children:e.jsx(O,{width:"100%",height:"100%",children:e.jsxs(ge,{margin:{top:20,right:20,bottom:20,left:20},children:[e.jsx(G,{type:"number",dataKey:"birth",name:"Birth",label:{value:"Birth Time",position:"bottom",offset:0,fontSize:12,fill:"currentColor"},tick:{fontSize:10},stroke:"currentColor",className:"text-muted-foreground"}),e.jsx(_,{type:"number",dataKey:"death",name:"Death",label:{value:"Death Time",angle:-90,position:"left",offset:0,fontSize:12,fill:"currentColor"},tick:{fontSize:10},stroke:"currentColor",className:"text-muted-foreground"}),e.jsx(H,{content:e.jsx(a,{}),cursor:{strokeDasharray:"3 3"}}),e.jsx(je,{segment:[{x:0,y:0},{x:1,y:1}],stroke:n?"#475569":"#cbd5e1",strokeDasharray:"3 3"}),e.jsx(be,{name:"Features",data:s,children:s.map((l,t)=>e.jsx(ye,{fill:l.dimension===0?"#3b82f6":l.dimension===1?"#22c55e":"#f97316",fillOpacity:.6,strokeWidth:1},`cell-${t}`))})]})})})]})}function ls({data:s}){const[r,n]=h.useState(0),[a,l]=h.useState(!1),t=h.useRef(),i=Math.max(...s.map(o=>o.death),1),d=o=>{n(c=>{const f=c+.005;return f>1.1?0:f}),t.current=requestAnimationFrame(d)};h.useEffect(()=>(a?t.current=requestAnimationFrame(d):t.current&&cancelAnimationFrame(t.current),()=>{t.current&&cancelAnimationFrame(t.current)}),[a]);const p=s.filter(o=>o.birth/i<=r&&o.death/i>=r),m=s.filter(o=>o.death/i<r);return e.jsxs("div",{className:"w-full h-full flex flex-col p-4 relative overflow-hidden",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4 z-10",children:[e.jsx("h3",{className:"text-sm font-medium",children:"Filtration Process"}),e.jsx("button",{onClick:()=>l(!a),className:"text-xs bg-primary/20 hover:bg-primary/30 text-primary px-2 py-1 rounded transition-colors",children:a?"Pause":"Play"})]}),e.jsxs("div",{className:"flex-1 relative border border-border/30 rounded-lg bg-slate-950/50 backdrop-blur-sm overflow-hidden",children:[e.jsxs("div",{className:"absolute inset-0 flex items-center justify-center",children:[e.jsx(P,{children:p.map(o=>e.jsx(g.div,{layoutId:o.id,initial:{scale:0,opacity:0},animate:{scale:1,opacity:.8},exit:{scale:.5,opacity:0},className:`absolute rounded-full border-2 ${o.dimension===0?"border-blue-500 bg-blue-500/20":o.dimension===1?"border-green-500 bg-green-500/20":"border-orange-500 bg-orange-500/20"}`,style:{left:`${parseInt(o.id.slice(-4),16)%80+10}%`,top:`${parseInt(o.id.slice(-3),16)%80+10}%`,width:"40px",height:"40px"}},o.id))}),m.map(o=>e.jsx("div",{className:`absolute rounded-full border ${o.dimension===0?"border-blue-900/30":o.dimension===1?"border-green-900/30":"border-orange-900/30"}`,style:{left:`${parseInt(o.id.slice(-4),16)%80+10}%`,top:`${parseInt(o.id.slice(-3),16)%80+10}%`,width:"40px",height:"40px",opacity:.2}},o.id))]}),e.jsx("div",{className:"absolute bottom-0 left-0 right-0 bg-primary/10 border-t border-primary/30 transition-all duration-75 ease-linear pointer-events-none",style:{height:`${r*100}%`}}),e.jsxs("div",{className:"absolute top-2 right-2 font-mono text-xs text-muted-foreground",children:["ε = ",r.toFixed(3)]})]})]})}function os(){const{analysisResult:s}=v(),r=h.useMemo(()=>{var l;if(!((l=s==null?void 0:s.topology_features)!=null&&l.landscape))return[];const{x:n,y:a}=s.topology_features.landscape;return n.map((t,i)=>({t,lambda:a[i]}))},[s]);return r.length?e.jsxs(A,{className:"h-full bg-slate-900 border-slate-800",children:[e.jsx(D,{className:"pb-2",children:e.jsxs(T,{className:"flex items-center gap-2 text-slate-100",children:[e.jsx(I,{className:"w-5 h-5 text-primary"}),"Persistence Landscape (H1)"]})}),e.jsx(F,{children:e.jsx("div",{className:"h-[200px] w-full",children:e.jsx(O,{width:"100%",height:"100%",children:e.jsxs(Ne,{data:r,children:[e.jsx("defs",{children:e.jsxs("linearGradient",{id:"colorLambda",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"5%",stopColor:"#8b5cf6",stopOpacity:.8}),e.jsx("stop",{offset:"95%",stopColor:"#8b5cf6",stopOpacity:0})]})}),e.jsx(ve,{strokeDasharray:"3 3",stroke:"#1e293b"}),e.jsx(G,{dataKey:"t",stroke:"#64748b",tick:{fontSize:12},tickFormatter:n=>n.toFixed(2)}),e.jsx(_,{stroke:"#64748b",tick:{fontSize:12}}),e.jsx(H,{contentStyle:{backgroundColor:"#0f172a",borderColor:"#1e293b"},itemStyle:{color:"#e2e8f0"},labelStyle:{color:"#94a3b8"},formatter:n=>[n.toFixed(4),"Prominence"],labelFormatter:n=>`t: ${Number(n).toFixed(2)}`}),e.jsx(we,{type:"monotone",dataKey:"lambda",stroke:"#8b5cf6",fillOpacity:1,fill:"url(#colorLambda)"})]})})})})]}):e.jsxs(A,{className:"h-full bg-slate-900 border-slate-800",children:[e.jsx(D,{children:e.jsxs(T,{className:"flex items-center gap-2 text-slate-100",children:[e.jsx(I,{className:"w-5 h-5 text-primary"}),"Persistence Landscape"]})}),e.jsx(F,{className:"flex items-center justify-center h-[200px] text-slate-500",children:"Waiting for H1 features..."})]})}function cs(){const{analysisResult:s}=v();if(!s||!s.scores)return e.jsxs(A,{className:"h-full bg-slate-900 border-slate-800",children:[e.jsx(D,{children:e.jsxs(T,{className:"flex items-center gap-2 text-slate-100",children:[e.jsx(k,{className:"w-5 h-5 text-primary"}),"Anomaly Score"]})}),e.jsx(F,{className:"flex items-center justify-center h-[200px] text-slate-500",children:"Waiting for analysis data..."})]});const{scores:r,topology_features:n}=s,a=s.is_anomaly,l=i=>i<40?"bg-green-500":i<70?"bg-yellow-500":"bg-red-500",t=i=>i<40?"text-green-500":i<70?"text-yellow-500":"text-red-500";return e.jsxs(A,{className:x("h-full bg-slate-900 border-slate-800 transition-colors duration-500",a?"border-red-500/50 shadow-[0_0_20px_rgba(239,68,68,0.2)]":""),children:[e.jsx(D,{className:"pb-2",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs(T,{className:"flex items-center gap-2 text-slate-100",children:[e.jsx(k,{className:x("w-5 h-5",a?"text-red-500 animate-pulse":"text-primary")}),"Anomaly Score"]}),e.jsx("span",{className:x("text-2xl font-bold",t(r.total)),children:r.total.toFixed(1)})]})}),e.jsxs(F,{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(y,{value:r.total,className:"h-3 bg-slate-800",indicatorClassName:l(r.total)}),e.jsxs("div",{className:"flex justify-between text-xs text-slate-400",children:[e.jsx("span",{children:"Normal"}),e.jsx("span",{children:"Critical"})]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 pt-2",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-1.5 text-xs text-slate-400",children:[e.jsx(Se,{className:"w-3.5 h-3.5"}),e.jsx("span",{children:"Structure"})]}),e.jsx("div",{className:"text-lg font-semibold text-slate-200",children:r.betti.toFixed(0)}),e.jsx(y,{value:r.betti,className:"h-1.5 bg-slate-800",indicatorClassName:"bg-blue-500"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-1.5 text-xs text-slate-400",children:[e.jsx(E,{className:"w-3.5 h-3.5"}),e.jsx("span",{children:"Entropy"})]}),e.jsx("div",{className:"text-lg font-semibold text-slate-200",children:r.entropy.toFixed(0)}),e.jsx(y,{value:r.entropy,className:"h-1.5 bg-slate-800",indicatorClassName:"bg-purple-500"}),e.jsxs("div",{className:"text-[10px] text-slate-500",children:[n==null?void 0:n.entropy.toFixed(2)," bits"]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-1.5 text-xs text-slate-400",children:[e.jsx(Ce,{className:"w-3.5 h-3.5"}),e.jsx("span",{children:"ML Model"})]}),e.jsx("div",{className:"text-lg font-semibold text-slate-200",children:r.ml.toFixed(0)}),e.jsx(y,{value:r.ml,className:"h-1.5 bg-slate-800",indicatorClassName:"bg-orange-500"})]})]})]})]})}const ds=()=>{const{persistenceDiagram:s}=v();return e.jsx(is,{data:s})},ms=()=>{const{persistenceDiagram:s}=v();return e.jsx(ns,{data:s})},xs=()=>{const{persistenceDiagram:s}=v();return e.jsx(ls,{data:s})};function Ns(){const[s,r]=h.useState(["anomaly-score","landscape","feed","timeline","threats","topology"]),[n,a]=h.useState(!1),[l,t]=h.useState(!0),{toast:i}=Pe(),{isSidebarCollapsed:d}=Re();h.useEffect(()=>{const u=setTimeout(()=>t(!1),1500);return()=>clearTimeout(u)},[]);const p=ke(L(Le),L(Ie,{coordinateGetter:We})),m=u=>{const{active:j,over:S}=u;j.id!==S.id&&r(W=>{const U=W.indexOf(j.id),q=W.indexOf(S.id);return Ee(W,U,q)})},o=u=>{r(s.filter(j=>j!==u)),i({title:"Widget Removed",description:"The widget has been removed from your dashboard."})},c=u=>{s.includes(u)||(r([...s,u]),a(!1),i({title:"Widget Added",description:"The widget has been added to your dashboard."}))},f=u=>{const j=V.find(S=>S.id===u);return j?j.title:"Widget"},w=u=>{if(l)return e.jsx(ss,{});switch(u){case"feed":return e.jsx(Xe,{className:"h-full"});case"timeline":return e.jsx(Je,{});case"threats":return e.jsx(qe,{});case"topology":return e.jsx(Ze,{});case"tda-stats":return e.jsx(rs,{});case"barcode":return e.jsx(ds,{});case"birth-death":return e.jsx(ms,{});case"filtration":return e.jsx(xs,{});case"landscape":return e.jsx(os,{});case"anomaly-score":return e.jsx(cs,{});default:return null}},z=()=>{window.open(`${Me}/api/anomalies/export?format=csv`,"_blank"),i({title:"Export Started",description:"Downloading anomaly data as CSV..."})};return e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsx($e,{}),e.jsxs("main",{className:x("pt-20 pb-8 px-4 sm:px-6 lg:px-8 max-w-[1800px] mx-auto transition-all duration-300",d?"md:pl-[80px]":"md:pl-[280px]"),children:[e.jsxs("div",{className:"flex justify-between items-center mb-8",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Dashboard"}),e.jsx("p",{className:"text-muted-foreground text-sm mt-1",children:"Real-time monitoring and anomaly detection."})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(N,{variant:"outline",size:"sm",onClick:z,children:[e.jsx(Ae,{className:"w-4 h-4 mr-2"})," Export Data"]}),e.jsxs(N,{size:"sm",onClick:()=>a(!0),children:[e.jsx(M,{className:"w-4 h-4 mr-2"})," Add Widget"]})]})]}),e.jsx(De,{sensors:p,collisionDetection:Te,onDragEnd:m,children:e.jsx(Fe,{items:s,strategy:ze,children:e.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 gap-6 auto-rows-[400px]","data-tour":"dashboard-widgets",children:s.map(u=>e.jsx(Qe,{id:u,title:f(u),onRemove:o,className:x(u==="timeline"?"lg:col-span-2":"","stagger-item"),children:w(u)},u))})})}),e.jsx(es,{open:n,onOpenChange:a,onAddWidget:c,activeWidgets:s}),e.jsx(ts,{})]})]})}export{Ns as default};
