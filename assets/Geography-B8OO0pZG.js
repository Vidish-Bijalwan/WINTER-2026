import{r as l,j as e,g as te,bp as se,bq as ae,br as z,bs as O,bt as W,bu as V,bv as ne,bw as ie,bx as re,by as oe,bz as le,bA as ce,bB as X,bC as de,bD as Z,bE as q,bF as _,o as F,G as T,b9 as ue,bG as me}from"./vendor-DGrUDQ2I.js";import{N as he}from"./Navigation-CoRmuU1R.js";import{u as C,d as pe,c as M,e as ge}from"./index-BR0G-Dds.js";import{C as E,a as U,b as I,d as B}from"./card-_tlfF8ea.js";import{S as L}from"./switch-uv_Q0Npu.js";import{L as R}from"./label-CkOlayJF.js";import{B as xe}from"./dialog-DwvOAkVq.js";import"./button-1vLT016S.js";const P={US:{lat:39.8283,lng:-98.5795,name:"United States"},GB:{lat:55.3781,lng:-3.436,name:"United Kingdom"},DE:{lat:51.1657,lng:10.4515,name:"Germany"},FR:{lat:46.2276,lng:2.2137,name:"France"},ES:{lat:40.4637,lng:-3.7492,name:"Spain"},IT:{lat:41.8719,lng:12.5674,name:"Italy"},CN:{lat:35.8617,lng:104.1954,name:"China"},JP:{lat:36.2048,lng:138.2529,name:"Japan"},IN:{lat:20.5937,lng:78.9629,name:"India"},RU:{lat:61.524,lng:105.3188,name:"Russia"},BR:{lat:-14.235,lng:-51.9253,name:"Brazil"},CA:{lat:56.1304,lng:-106.3468,name:"Canada"},AU:{lat:-25.2744,lng:133.7751,name:"Australia"},KR:{lat:35.9078,lng:127.7669,name:"South Korea"},MX:{lat:23.6345,lng:-102.5528,name:"Mexico"},NL:{lat:52.1326,lng:5.2913,name:"Netherlands"},SE:{lat:60.1282,lng:18.6435,name:"Sweden"},PL:{lat:51.9194,lng:19.1451,name:"Poland"},AR:{lat:-38.4161,lng:-63.6167,name:"Argentina"},ZA:{lat:-30.5595,lng:22.9375,name:"South Africa"}},fe={"en.wikipedia.org":"US","de.wikipedia.org":"DE","fr.wikipedia.org":"FR","es.wikipedia.org":"ES","it.wikipedia.org":"IT","ja.wikipedia.org":"JP","zh.wikipedia.org":"CN","ru.wikipedia.org":"RU","pt.wikipedia.org":"BR","nl.wikipedia.org":"NL","pl.wikipedia.org":"PL","sv.wikipedia.org":"SE","ko.wikipedia.org":"KR"};function j(a){try{const n=new URL(a.serverUrl).hostname,h=fe[n]||"US",d=P[h];if(d){const g=(Math.random()-.5)*10,r=(Math.random()-.5)*10;return{lat:d.lat+g,lng:d.lng+r,country:d.name,countryCode:h}}}catch(t){console.warn("Failed to extract geo from event",t)}return null}function $(a,t,n=50){const h=[];for(let d=0;d<=n;d++){const g=d/n,r=a.lat+(t.lat-a.lat)*g,u=a.lng+(t.lng-a.lng)*g,i=Math.sin(g*Math.PI)*.2;h.push([u,r+i])}return h}function be(a){const t={};return a.forEach(n=>{const h=j(n);h&&(t[h.countryCode]=(t[h.countryCode]||0)+1)}),t}function je(a,t){const n=a/t;return n>.75?"#dc2626":n>.5?"#f97316":n>.25?"#fbbf24":"#34d399"}function ye({className:a}){const{events:t}=C(),{recentEvents:n}=pe(),[h,d]=l.useState([]),[g,r]=l.useState([]),[u,i]=l.useState([]),[o,m]=l.useState(!0),[b,S]=l.useState(!1),[G,Y]=l.useState(!0);l.useEffect(()=>{const c=t.slice(0,100).map(s=>{const p=j(s);return p?{id:s.id,position:[p.lat,p.lng],event:s,geo:p,timestamp:s.timestamp.getTime()}:null}).filter(s=>s!==null),f=n.slice(0,50).map(s=>{const p=Math.random()*140-70,x=Math.random()*360-180;return{id:s.id,position:[p,x],event:{title:s.content,user:s.source,bot:!0,timestamp:new Date(s.timestamp)},geo:{lat:p,lng:x,country:"Simulated",countryCode:"XX"},timestamp:new Date(s.timestamp).getTime()}}),N=[...c,...f];d(N);const y=new Map;N.forEach(s=>{const p=`${Math.round(s.geo.lat)},${Math.round(s.geo.lng)}`,x=y.get(p);x?x.count++:y.set(p,{lat:Math.round(s.geo.lat),lng:Math.round(s.geo.lng),count:1})});const ee=Array.from(y.values()).map(s=>({lat:s.lat,lng:s.lng,intensity:s.count}));r(ee);const k=[];for(let s=0;s<Math.min(t.length-1,50);s++){const p=j(t[s]),x=j(t[s+1]);if(p&&x&&p.countryCode!==x.countryCode){const A=$(p,x,30);k.push({id:`${t[s].id}-${t[s+1].id}`,path:A,color:t[s].bot?"#818cf8":"#34d399"})}}if(f.length>1)for(let s=0;s<Math.min(f.length-1,20);s++){const p=f[s].geo,x=f[s+1].geo,A=$(p,x,30);k.push({id:`sim-${s}`,path:A,color:"#f472b6"})}i(k)},[t,n]);const D=Math.max(...g.map(c=>c.intensity),1);return e.jsxs("div",{className:`relative ${a}`,children:[e.jsxs(E,{className:"absolute top-4 right-4 z-[1000] p-4 bg-slate-900/90 border-slate-700 backdrop-blur-md w-64",children:[e.jsx("h3",{className:"text-sm font-semibold text-slate-200 mb-3",children:"Map Layers"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(te,{className:"w-4 h-4 text-emerald-500"}),e.jsx(R,{className:"text-xs text-slate-300",children:"Live Edits"})]}),e.jsx(L,{checked:o,onCheckedChange:m})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(se,{className:"w-4 h-4 text-red-500"}),e.jsx(R,{className:"text-xs text-slate-300",children:"Heatmap"})]}),e.jsx(L,{checked:b,onCheckedChange:S})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ae,{className:"w-4 h-4 text-indigo-500"}),e.jsx(R,{className:"text-xs text-slate-300",children:"Flow Arcs"})]}),e.jsx(L,{checked:G,onCheckedChange:Y})]})]})]}),e.jsxs(z,{center:[20,0],zoom:2,style:{height:"100%",width:"100%"},className:"rounded-lg z-0",children:[e.jsx(O,{attribution:'© <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> © <a href="https://carto.com/attributions">CARTO</a>',url:"https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png"}),o&&h.map(c=>e.jsx(W,{center:c.position,radius:6,pathOptions:{fillColor:c.event.bot?"#6366f1":"#10b981",fillOpacity:.7,color:"#fff",weight:1},children:e.jsx(V,{children:e.jsxs("div",{className:"text-sm",children:[e.jsx("div",{className:"font-semibold",children:c.event.title}),e.jsxs("div",{className:"text-xs text-muted-foreground mt-1",children:["By: ",c.event.user]}),e.jsx("div",{className:"text-xs text-muted-foreground",children:c.geo.country})]})})},c.id)),b&&g.map((c,f)=>{const N=c.intensity/D,y=5e4*(c.intensity/D+.2);return e.jsx(ne,{center:[c.lat,c.lng],radius:y,pathOptions:{fillColor:"#ef4444",fillOpacity:N*.5,color:"transparent",weight:0}},`heat-${f}`)}),G&&u.map(c=>e.jsx(ie,{positions:c.path,pathOptions:{color:c.color,weight:1.5,opacity:.5}},c.id))]})]})}function J({className:a}){const{events:t}=C(),[n,h]=l.useState({}),[d,g]=l.useState(1);l.useEffect(()=>{const i=be(t);h(i),g(Math.max(...Object.values(i),1))},[t]);const u={type:"FeatureCollection",features:Object.entries(n).map(([i,o])=>{const m=P[i];return m?{type:"Feature",properties:{name:m.name,code:i,count:o},geometry:{type:"Point",coordinates:[m.lng,m.lat]}}:null}).filter(Boolean)};return e.jsx("div",{className:a,children:e.jsxs("div",{className:"p-4 bg-card rounded-lg border",children:[e.jsx("h3",{className:"text-sm font-semibold mb-3",children:"Top Countries by Edit Volume"}),e.jsx("div",{className:"space-y-2 mb-4",children:Object.entries(n).sort(([,i],[,o])=>o-i).slice(0,5).map(([i,o])=>{const m=P[i];return m?e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{children:m.name}),e.jsx("span",{className:"font-mono text-primary",children:o})]},i):null})}),e.jsxs(z,{center:[20,0],zoom:2,style:{height:"400px",width:"100%"},className:"rounded-lg",children:[e.jsx(O,{attribution:'© <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a>',url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"}),e.jsx(re,{data:u,pointToLayer:(i,o)=>{const m=i.properties.count,b=10+m/d*40;return oe.circleMarker(o,{radius:b,fillColor:je(m,d),fillOpacity:.7,color:"#fff",weight:2})},onEachFeature:(i,o)=>{o.bindPopup(`
                <b>${i.properties.name}</b><br/>
                Edits: ${i.properties.count}
              `)}})]})]})})}const H={en:"#3b82f6",de:"#eab308",fr:"#8b5cf6",es:"#f97316",it:"#10b981",ja:"#ec4899",zh:"#ef4444",ru:"#14b8a6",pt:"#06b6d4"};function K({className:a}){const{events:t}=C(),[n,h]=l.useState({}),[d,g]=l.useState([]);return l.useEffect(()=>{const r={},u=[];t.slice(0,200).forEach(i=>{const o=j(i);if(!o)return;const m=i.wiki.substring(0,2);r[m]=(r[m]||0)+1,u.push({position:[o.lat,o.lng],lang:m,event:i})}),h(r),g(u)},[t]),e.jsx("div",{className:a,children:e.jsxs("div",{className:"p-4 bg-card rounded-lg border",children:[e.jsx("h3",{className:"text-sm font-semibold mb-3",children:"Wiki Language Clusters"}),e.jsx("div",{className:"flex flex-wrap gap-2 mb-3",children:Object.entries(n).sort(([,r],[,u])=>u-r).slice(0,8).map(([r,u])=>e.jsxs(xe,{variant:"secondary",style:{backgroundColor:H[r]+"33"},children:[r.toUpperCase(),": ",u]},r))}),e.jsxs(z,{center:[20,0],zoom:2,style:{height:"400px",width:"100%"},className:"rounded-lg",children:[e.jsx(O,{attribution:"© OpenStreetMap",url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"}),d.map((r,u)=>e.jsx(W,{center:r.position,radius:5,pathOptions:{fillColor:H[r.lang]||"#gray",fillOpacity:.7,color:"#fff",weight:1},children:e.jsx(V,{children:e.jsxs("div",{className:"text-xs",children:[e.jsx("div",{className:"font-semibold",children:r.event.title}),e.jsxs("div",{className:"text-muted-foreground",children:["Language: ",r.lang.toUpperCase()]})]})})},u))]})]})})}function Ne(){const{events:a}=C(),t=l.useRef(null),[n,h]=l.useState(new Float32Array(0));return l.useEffect(()=>{const d=[];a.slice(0,500).forEach(g=>{const r=j(g);if(!r)return;const u=(90-r.lat)*(Math.PI/180),i=(r.lng+180)*(Math.PI/180),o=2.1,m=-(o*Math.sin(u)*Math.cos(i)),b=o*Math.cos(u),S=o*Math.sin(u)*Math.sin(i);d.push(m,b,S)}),h(new Float32Array(d))},[a]),X(()=>{t.current&&(t.current.rotation.y+=.001)}),e.jsxs("points",{ref:t,children:[e.jsx("bufferGeometry",{children:e.jsx("bufferAttribute",{attach:"attributes-position",count:n.length/3,array:n,itemSize:3})}),e.jsx("pointsMaterial",{size:.05,color:"#10b981",sizeAttenuation:!0,transparent:!0,opacity:.8})]})}function ve(){const a=l.useRef(null);return X(()=>{a.current&&(a.current.rotation.y+=.002)}),e.jsxs("mesh",{ref:a,children:[e.jsx("sphereGeometry",{args:[2,64,64]}),e.jsx("meshStandardMaterial",{color:"#1e293b",wireframe:!0,opacity:.1,transparent:!0})]})}function we({className:a}){return e.jsx("div",{className:a,children:e.jsxs("div",{className:"p-4 bg-card rounded-lg border",children:[e.jsx("h3",{className:"text-sm font-semibold mb-3",children:"3D Globe Visualization"}),e.jsx("div",{style:{height:"500px",width:"100%"},className:"rounded-lg overflow-hidden bg-slate-950",children:e.jsxs(le,{camera:{position:[0,0,5],fov:50},children:[e.jsx("ambientLight",{intensity:.5}),e.jsx("pointLight",{position:[10,10,10]}),e.jsx(ve,{}),e.jsx(Ne,{}),e.jsx(ce,{enableZoom:!0,enablePan:!1,minDistance:3,maxDistance:8})]})})]})})}const Ce=de,Q=l.forwardRef(({className:a,...t},n)=>e.jsx(Z,{ref:n,className:M("inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",a),...t}));Q.displayName=Z.displayName;const v=l.forwardRef(({className:a,...t},n)=>e.jsx(q,{ref:n,className:M("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",a),...t}));v.displayName=q.displayName;const w=l.forwardRef(({className:a,...t},n)=>e.jsx(_,{ref:n,className:M("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",a),...t}));w.displayName=_.displayName;const ze=()=>{const{isSidebarCollapsed:a}=ge();return e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsx(he,{}),e.jsxs("main",{className:M("pt-20 pb-8 px-4 sm:px-6 lg:px-8 max-w-[1800px] mx-auto transition-all duration-300",a?"md:pl-[80px]":"md:pl-[280px]"),children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs(F.h1,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},className:"text-2xl font-bold flex items-center gap-2",children:[e.jsx(T,{className:"w-6 h-6 text-primary"}),"Geographic Intelligence"]}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"Global visualization of Wikipedia edit activity and topological structures."})]}),e.jsxs(Ce,{defaultValue:"map",className:"space-y-6",children:[e.jsx("div",{className:"flex justify-between items-center",children:e.jsxs(Q,{className:"bg-slate-900 border border-slate-800",children:[e.jsxs(v,{value:"map",className:"gap-2",children:[e.jsx(ue,{className:"w-4 h-4"})," 2D Map"]}),e.jsxs(v,{value:"globe",className:"gap-2",children:[e.jsx(T,{className:"w-4 h-4"})," 3D Globe"]}),e.jsxs(v,{value:"analytics",className:"gap-2",children:[e.jsx(me,{className:"w-4 h-4"})," Analytics"]})]})}),e.jsx(w,{value:"map",className:"space-y-6",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-4 gap-6 h-[700px]",children:[e.jsx(F.div,{initial:{opacity:0,scale:.98},animate:{opacity:1,scale:1},className:"lg:col-span-3 h-full bg-slate-900 rounded-xl border border-slate-800 overflow-hidden shadow-2xl relative",children:e.jsx(ye,{className:"h-full w-full"})}),e.jsxs("div",{className:"space-y-6 h-full overflow-y-auto pr-2",children:[e.jsx(J,{}),e.jsx(K,{})]})]})}),e.jsx(w,{value:"globe",children:e.jsx("div",{className:"h-[700px] bg-slate-900 rounded-xl border border-slate-800 overflow-hidden",children:e.jsx(we,{})})}),e.jsx(w,{value:"analytics",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs(E,{className:"bg-slate-900 border-slate-800",children:[e.jsx(U,{children:e.jsx(I,{children:"Regional Activity"})}),e.jsx(B,{children:e.jsx(J,{})})]}),e.jsxs(E,{className:"bg-slate-900 border-slate-800",children:[e.jsx(U,{children:e.jsx(I,{children:"Language Distribution"})}),e.jsx(B,{children:e.jsx(K,{})})]})]})})]})]})]})};export{ze as default};
