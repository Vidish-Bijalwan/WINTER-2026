import{a9 as N,j as e,o as g,aa as T,ab as M,U as B,ac as $,ad as O,ae as G,r as u,af as H,ag as V,ah as K,ai as _,aj as U,ak as q,X as Z,g as k,al as Y,am as F,an as X,f as W,ao as J,ap as Q,aq as ee,ar as z,as as se,at as te,au as I,av as ae,aw as re,Z as ie,b as E,ax as ne,ay as le,az as oe,aA as ce,aB as de,aC as me,aD as xe,aE as ue,aF as he,aG as A,aH as pe,aI as fe,aJ as ge,aK as je,aL as be,aM as ye,aN as ve,aO as Ne}from"./vendor-BPNd0lDP.js";import{B as y}from"./button-TxjNP0dA.js";import{u as w,c as h,a as we}from"./index-B2lD_z9c.js";import{S as Se,D as Ce,a as De,b as ke,c as Ae,d as Te,e as Fe,f as We,N as ze}from"./Navigation-PwT9yHHg.js";import{B as R}from"./badge-p9Elgbwt.js";import{T as Ie}from"./ThreatIntelCard-DWs5ZplS.js";import{P as Ee}from"./PersistenceDiagram-DsPDrhlg.js";import{C as Re,a as Le,b as Pe,d as Me}from"./card-DA2NkwAB.js";const Be=N.forwardRef(({event:s,index:n},o)=>{const a=s.delta&&s.delta>0?"text-success":s.delta&&s.delta<0?"text-critical":"text-muted-foreground",l=i=>{if(!i)return null;const d=i>0?"+":"";return Math.abs(i)>=1e3?`${d}${(i/1e3).toFixed(1)}K`:`${d}${i}`},t=()=>s.type==="new"?e.jsx($,{className:"w-3 h-3"}):s.type==="categorize"?e.jsx(O,{className:"w-3 h-3"}):e.jsx(G,{className:"w-3 h-3"});return e.jsx(g.div,{ref:o,initial:{opacity:0,x:-20,height:0},animate:{opacity:1,x:0,height:"auto"},exit:{opacity:0,x:20,height:0},transition:{duration:.2,delay:n*.02},className:"border-b border-border/30 py-2 px-1 last:border-0",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("div",{className:h("p-1 rounded mt-0.5",s.type==="new"?"bg-success/10 text-success":"bg-primary/10 text-primary"),children:t()}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-1.5 mb-0.5",children:[e.jsx("span",{className:"text-xs font-medium truncate max-w-[180px]",title:s.title,children:s.title}),s.minor&&e.jsx(R,{variant:"outline",className:"text-[8px] px-1 py-0",children:"m"})]}),e.jsxs("div",{className:"flex items-center gap-2 text-[10px] text-muted-foreground",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[s.bot?e.jsx(M,{className:"w-3 h-3"}):e.jsx(B,{className:"w-3 h-3"}),e.jsx("span",{className:"truncate max-w-[80px]",title:s.user,children:s.user})]}),e.jsx("span",{className:"opacity-50",children:"•"}),e.jsx("span",{className:"font-mono opacity-70",children:s.wiki.replace("wiki","")}),s.delta!==void 0&&s.delta!==0&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"opacity-50",children:"•"}),e.jsx("span",{className:h("font-mono font-medium",a),children:l(s.delta)})]})]})]}),e.jsx("span",{className:"text-[9px] text-muted-foreground shrink-0",children:s.timestamp.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",second:"2-digit"})})]})})});function $e({className:s,maxItems:n=15}){const{events:o,isConnected:a,eventsPerSecond:l}=w(),[t,i]=N.useState([]),[d,p]=N.useState("all");N.useEffect(()=>{o.length>0&&i(c=>[...o,...c].slice(0,50))},[o]);const r=t.filter(c=>d==="all"?!0:d==="bot"?c.bot:d==="user"?!c.bot:!0).slice(0,n);return e.jsxs("div",{className:h("relative h-full flex flex-col",s),children:[e.jsxs("div",{className:"flex items-center justify-between mb-2 px-1 shrink-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm font-medium",children:"Live Feed"}),a&&e.jsxs(g.div,{className:"flex items-center gap-1 px-1.5 py-0.5 rounded-full bg-success/10 text-success text-[9px]",animate:{opacity:[.7,1,.7]},transition:{duration:2,repeat:1/0},children:[e.jsx("span",{className:"w-1.5 h-1.5 rounded-full bg-success"}),l,"/s"]})]}),e.jsxs("div",{className:"flex items-center gap-1 bg-slate-800/50 rounded-lg p-0.5",children:[e.jsx("button",{onClick:()=>p("all"),className:h("px-2 py-0.5 text-[10px] rounded transition-colors",d==="all"?"bg-primary/20 text-primary":"text-muted-foreground hover:text-foreground"),children:"All"}),e.jsx("button",{onClick:()=>p("user"),className:h("px-2 py-0.5 text-[10px] rounded transition-colors",d==="user"?"bg-primary/20 text-primary":"text-muted-foreground hover:text-foreground"),children:"User"}),e.jsx("button",{onClick:()=>p("bot"),className:h("px-2 py-0.5 text-[10px] rounded transition-colors",d==="bot"?"bg-primary/20 text-primary":"text-muted-foreground hover:text-foreground"),children:"Bot"})]})]}),e.jsx(Se,{className:"flex-1 pr-2 -mr-2",children:e.jsx("div",{className:"pr-2",children:e.jsx(T,{mode:"popLayout",initial:!1,children:r.length>0?r.map((c,f)=>e.jsx(Be,{event:c,index:f},c.id)):e.jsx(g.div,{initial:{opacity:0},animate:{opacity:1},className:"py-8 text-center text-muted-foreground",children:e.jsx("p",{className:"text-xs",children:a?"Waiting for events...":"Connect to see live edits"})})})})}),a&&r.length>0&&e.jsxs("div",{className:"mt-2 pt-2 border-t border-border/30 flex items-center justify-between text-[10px] text-muted-foreground shrink-0",children:[e.jsxs("span",{children:[r.filter(c=>c.bot).length," bot edits"]}),e.jsxs("span",{children:[r.filter(c=>c.type==="new").length," new articles"]})]})]})}function Oe({className:s}){var p;const{timeline:n,isConnected:o}=w(),a=u.useMemo(()=>n.length>0?n:Array.from({length:24},(m,r)=>({time:`${String(r).padStart(2,"0")}:00`,timestamp:new Date,value:.1+Math.random()*.1,anomaly:!1,eventCount:0})),[n]),l=Math.max(...a.map(m=>m.value),.1),t=100/(a.length-1),i=a.map((m,r)=>{const c=r*t,f=100-m.value/l*80;return`${r===0?"M":"L"} ${c} ${f}`}).join(" "),d=`${i} L 100 100 L 0 100 Z`;return e.jsxs("div",{className:h("relative bg-card/50 rounded-xl p-4 border border-border/50",s),children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm font-medium text-foreground",children:"Anomaly Timeline"}),o&&e.jsxs(g.div,{className:"flex items-center gap-1 px-2 py-0.5 rounded-full bg-success/10 text-success text-[10px]",animate:{opacity:[.7,1,.7]},transition:{duration:2,repeat:1/0},children:[e.jsx("span",{className:"w-1.5 h-1.5 rounded-full bg-success"}),"Live"]})]}),e.jsxs("div",{className:"flex gap-3 text-xs",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-anomaly"}),e.jsx("span",{className:"text-muted-foreground",children:"Warning"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-critical"}),e.jsx("span",{className:"text-muted-foreground",children:"Critical"})]})]})]}),e.jsxs("svg",{className:"w-full h-32",viewBox:"0 0 100 100",preserveAspectRatio:"none",children:[e.jsxs("defs",{children:[e.jsxs("linearGradient",{id:"areaGradient",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"0%",stopColor:"hsl(var(--primary))",stopOpacity:"0.3"}),e.jsx("stop",{offset:"100%",stopColor:"hsl(var(--primary))",stopOpacity:"0"})]}),e.jsxs("linearGradient",{id:"lineGradient",x1:"0",y1:"0",x2:"1",y2:"0",children:[e.jsx("stop",{offset:"0%",stopColor:"hsl(var(--primary))"}),e.jsx("stop",{offset:"50%",stopColor:"hsl(var(--primary-glow))"}),e.jsx("stop",{offset:"100%",stopColor:"hsl(var(--primary))"})]})]}),e.jsx("g",{opacity:"0.1",children:[25,50,75].map(m=>e.jsx("line",{x1:"0",y1:m,x2:"100",y2:m,stroke:"hsl(var(--foreground))",strokeWidth:"0.5"},m))}),e.jsx(g.path,{d,fill:"url(#areaGradient)",initial:{opacity:0},animate:{opacity:1},transition:{duration:1}}),e.jsx(g.path,{d:i,fill:"none",stroke:"url(#lineGradient)",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",initial:{pathLength:0},animate:{pathLength:1},transition:{duration:2,ease:"easeOut"}}),a.map((m,r)=>{if(!m.anomaly)return null;const c=r*t,f=100-m.value/l*80,x="severity"in m&&m.severity==="critical";return e.jsxs(g.g,{children:[e.jsx(g.circle,{cx:c||0,cy:f||0,r:"8",fill:x?"hsl(var(--critical))":"hsl(var(--anomaly))",opacity:"0.3",animate:{r:[8,15,8],opacity:[.3,0,.3]},transition:{duration:2,repeat:1/0}}),e.jsx(g.circle,{cx:c||0,cy:f||0,r:"4",fill:x?"hsl(var(--critical))":"hsl(var(--anomaly))",initial:{scale:0},animate:{scale:1},transition:{delay:r*.05+.5,type:"spring"}})]},r)}),a.length>0&&e.jsx(g.circle,{cx:100,cy:100-a[a.length-1].value/l*80,r:"4",fill:"hsl(var(--primary))",animate:{r:[4,6,4],opacity:[1,.7,1]},transition:{duration:1.5,repeat:1/0}})]}),e.jsx("div",{className:"flex justify-between mt-2 text-[10px] text-muted-foreground",children:a.filter((m,r)=>r%Math.max(1,Math.floor(a.length/6))===0).map((m,r)=>e.jsx("span",{children:m.time},r))}),o&&n.length>0&&e.jsxs("div",{className:"absolute bottom-4 right-4 text-[10px] text-muted-foreground bg-card/80 px-2 py-1 rounded",children:[((p=n[n.length-1])==null?void 0:p.eventCount)||0," events/interval"]})]})}function Ge({id:s,title:n,children:o,onRemove:a,className:l}){const{attributes:t,listeners:i,setNodeRef:d,transform:p,transition:m,isDragging:r}=H({id:s}),[c,f]=N.useState(!1),[x,j]=N.useState(!1),v={transform:V.Transform.toString(p),transition:m,zIndex:r||c?50:"auto",position:c?"fixed":"relative",top:c?0:"auto",left:c?0:"auto",right:c?0:"auto",bottom:c?0:"auto",width:c?"100vw":"auto",height:c?"100vh":"100%"},S=()=>{j(!0),setTimeout(()=>j(!1),1e3)},D=s==="feed"?"live-feed":s==="topology"?"topology-viz":void 0;return e.jsx("div",{ref:d,style:v,className:h("h-full",l,c&&"z-[100] p-4 bg-background/80 backdrop-blur-sm"),"data-tour":D,children:e.jsxs(Re,{className:h("h-full flex flex-col overflow-hidden transition-all duration-200 glass-card",r&&"shadow-2xl ring-2 ring-primary/50 opacity-80 rotate-1",c&&"border-primary/20 shadow-2xl"),children:[e.jsxs(Le,{className:"flex flex-row items-center justify-between space-y-0 pb-2 p-4 border-b border-slate-800/50",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[!c&&e.jsx("div",{...t,...i,className:"cursor-grab active:cursor-grabbing p-1 hover:bg-slate-800 rounded transition-colors",children:e.jsx(K,{className:"w-4 h-4 text-slate-500"})}),e.jsxs(Pe,{className:"text-sm font-medium text-slate-200 flex items-center gap-2",children:[n,x&&e.jsx("span",{className:"text-xs text-muted-foreground animate-pulse",children:"Refreshing..."})]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(y,{variant:"ghost",size:"icon",className:h("h-6 w-6 text-slate-500 hover:text-primary",x&&"animate-spin text-primary"),onClick:S,children:e.jsx(_,{className:"w-3 h-3"})}),e.jsx(y,{variant:"ghost",size:"icon",className:"h-6 w-6 text-slate-500 hover:text-primary",onClick:()=>f(!c),children:c?e.jsx(U,{className:"w-3 h-3"}):e.jsx(q,{className:"w-3 h-3"})}),a&&!c&&e.jsx(y,{variant:"ghost",size:"icon",className:"h-6 w-6 text-slate-500 hover:text-red-400 hover:bg-red-500/10",onClick:()=>a(s),children:e.jsx(Z,{className:"w-3 h-3"})})]})]}),e.jsx(Me,{className:"flex-1 p-0 h-[calc(100%-60px)] relative overflow-hidden",children:o})]})})}const L=[{id:"feed",title:"Live Event Feed",description:"Real-time stream of Wikipedia edits and anomalies.",icon:k,defaultSize:"medium"},{id:"timeline",title:"Anomaly Timeline",description:"Historical view of detected anomalies over time.",icon:Y,defaultSize:"large"},{id:"threats",title:"Threat Intelligence",description:"Latest threat indicators and C2 server detections.",icon:F,defaultSize:"medium"},{id:"topology",title:"Persistence Diagram",description:"Topological data analysis visualization.",icon:X,defaultSize:"medium"},{id:"tda-stats",title:"Advanced TDA Metrics",description:"Wasserstein distance, landscapes, and multi-modal anomaly scores.",icon:W,defaultSize:"medium"},{id:"barcode",title:"Persistence Barcode",description:"Interactive barcode showing feature lifetimes.",icon:J,defaultSize:"large"},{id:"birth-death",title:"Birth-Death Plane",description:"Scatter plot of topological features.",icon:Q,defaultSize:"medium"},{id:"filtration",title:"Filtration Animation",description:"Visual timeline of the filtration process.",icon:ee,defaultSize:"medium"}];function He({open:s,onOpenChange:n,onAddWidget:o,activeWidgets:a}){return e.jsx(Ce,{open:s,onOpenChange:n,children:e.jsxs(De,{className:"sm:max-w-[500px] bg-slate-900 border-slate-800 text-slate-200",children:[e.jsxs(ke,{children:[e.jsx(Ae,{children:"Add Widget"}),e.jsx(Te,{className:"text-slate-400",children:"Choose a widget to add to your dashboard."})]}),e.jsx("div",{className:"grid gap-4 py-4",children:L.map(l=>{const t=a.includes(l.id);return e.jsxs("div",{className:h("flex items-start gap-4 p-3 rounded-lg border transition-all",t?"border-slate-800 bg-slate-800/50 opacity-50 cursor-not-allowed":"border-slate-700 bg-slate-800/30 hover:bg-slate-800 hover:border-primary/50 cursor-pointer"),onClick:()=>!t&&o(l.id),children:[e.jsx("div",{className:h("p-2 rounded-md",t?"bg-slate-700":"bg-primary/10 text-primary"),children:e.jsx(l.icon,{className:"w-5 h-5"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"text-sm font-medium leading-none mb-1.5",children:l.title}),e.jsx("p",{className:"text-xs text-slate-400 leading-snug",children:l.description})]}),!t&&e.jsx(y,{size:"icon",variant:"ghost",className:"h-8 w-8 text-primary",children:e.jsx(z,{className:"w-4 h-4"})})]},l.id)})}),e.jsx(Fe,{children:e.jsx(We,{asChild:!0,children:e.jsx(y,{variant:"ghost",children:"Cancel"})})})]})})}function b({className:s,...n}){return e.jsx("div",{className:h("animate-pulse rounded-md bg-muted",s),...n})}function Ve(){return e.jsxs("div",{className:"p-4 space-y-4 h-full",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx(b,{className:"h-12 w-12 rounded-full bg-slate-800"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(b,{className:"h-4 w-[250px] bg-slate-800"}),e.jsx(b,{className:"h-4 w-[200px] bg-slate-800"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(b,{className:"h-4 w-full bg-slate-800"}),e.jsx(b,{className:"h-4 w-full bg-slate-800"}),e.jsx(b,{className:"h-4 w-3/4 bg-slate-800"})]}),e.jsxs("div",{className:"pt-4 grid grid-cols-3 gap-4",children:[e.jsx(b,{className:"h-20 w-full bg-slate-800"}),e.jsx(b,{className:"h-20 w-full bg-slate-800"}),e.jsx(b,{className:"h-20 w-full bg-slate-800"})]})]})}function Ke(){const[s,n]=u.useState(!1);u.useEffect(()=>{if(localStorage.getItem("toposhape_tour_seen"))n(!0);else{const l=setTimeout(()=>{o()},2e3);return()=>clearTimeout(l)}},[]);const o=()=>{const a=se({showProgress:!0,animate:!0,steps:[{element:"nav",popover:{title:"Welcome to TopoShape Insights",description:"Your advanced platform for topological data analysis and anomaly detection.",side:"right",align:"start"}},{element:'[data-tour="dashboard-widgets"]',popover:{title:"Interactive Dashboard",description:'Drag and drop widgets to customize your view. Click the "Add Widget" button to add more.',side:"bottom",align:"start"}},{element:'[data-tour="theme-toggle"]',popover:{title:"Theme & Customization",description:"Switch between Dark and Light modes here. Use Cmd+K to open the Command Palette for quick actions.",side:"bottom",align:"end"}},{element:'[data-tour="live-feed"]',popover:{title:"Real-time Feed",description:"Watch live events stream in. TDA algorithms process these in real-time to detect anomalies.",side:"left",align:"start"}},{element:'[data-tour="topology-viz"]',popover:{title:"Topological Analysis",description:"Visualize persistence diagrams and Betti numbers to understand the shape of your data.",side:"left",align:"start"}}],onDestroyStarted:()=>{(!a.hasNextStep()||confirm("Are you sure you want to stop the tour?"))&&(a.destroy(),localStorage.setItem("toposhape_tour_seen","true"),n(!0))}});a.drive()};return e.jsx(y,{variant:"ghost",size:"icon",className:"fixed bottom-4 right-4 z-50 rounded-full w-10 h-10 bg-primary/10 text-primary hover:bg-primary/20 shadow-lg backdrop-blur-sm border border-primary/20",onClick:o,title:"Start Tour",children:e.jsx(te,{className:"w-5 h-5"})})}function _e(s){const[n,o]=u.useState(null),a=u.useRef(null),l=u.useRef(0),t=u.useRef(!1);return u.useEffect(()=>(a.current=new Worker(new URL("/WINTER-2026/assets/tda.worker-1-1pGS40.js",import.meta.url),{type:"module"}),a.current.onmessage=i=>{const{type:d,payload:p}=i.data;d==="RESULT"?(o(p),t.current=!1):d==="ERROR"&&(console.error("TDA Worker Error:",p.message),t.current=!1)},a.current.postMessage({type:"INIT",payload:{windowSize:50}}),()=>{var i;(i=a.current)==null||i.terminate()}),[]),u.useEffect(()=>{var d;const i=Date.now();i-l.current<2e3||t.current||s.length<10||(t.current=!0,l.current=i,(d=a.current)==null||d.postMessage({type:"ANALYZE",payload:{events:s,windowMs:3e4}}))},[s]),n}const C=u.forwardRef(({className:s,value:n,...o},a)=>e.jsx(I,{ref:a,className:h("relative h-4 w-full overflow-hidden rounded-full bg-secondary",s),...o,children:e.jsx(ae,{className:"h-full w-full flex-1 bg-primary transition-all",style:{transform:`translateX(-${100-(n||0)}%)`}})}));C.displayName=I.displayName;function Ue(){const{events:s}=w(),n=_e(s);if(!n)return e.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-muted-foreground space-y-2",children:[e.jsx(k,{className:"w-8 h-8 animate-pulse text-primary/50"}),e.jsx("p",{className:"text-sm",children:"Initializing TDA Engine..."})]});const{score:o,processingTime:a}=n,l=o.isAnomaly;return e.jsxs("div",{className:"p-4 space-y-6 h-full overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[l?e.jsx(F,{className:"w-5 h-5 text-red-500 animate-pulse"}):e.jsx(re,{className:"w-5 h-5 text-green-500"}),e.jsx("span",{className:"font-medium text-sm",children:"System Status"})]}),e.jsx(R,{variant:l?"destructive":"outline",className:h(l?"animate-pulse":"bg-green-500/10 text-green-500 border-green-500/20"),children:l?"ANOMALY DETECTED":"STABLE"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-xs",children:[e.jsxs("span",{className:"text-muted-foreground flex items-center gap-1",children:[e.jsx(k,{className:"w-3 h-3"})," Wasserstein Distance"]}),e.jsx("span",{className:"font-mono",children:o.components.wasserstein.toFixed(2)})]}),e.jsx(C,{value:Math.min(o.components.wasserstein*10,100),className:"h-1.5"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-xs",children:[e.jsxs("span",{className:"text-muted-foreground flex items-center gap-1",children:[e.jsx(W,{className:"w-3 h-3"})," Landscape Norm (Z-Score)"]}),e.jsx("span",{className:"font-mono",children:o.components.landscape.toFixed(2)})]}),e.jsx(C,{value:Math.min(o.components.landscape*20,100),className:"h-1.5"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-xs",children:[e.jsx("span",{className:"text-muted-foreground",children:"Combined Anomaly Score"}),e.jsx("span",{className:h("font-mono font-bold",o.totalScore>3?"text-red-400":"text-green-400"),children:o.totalScore.toFixed(2)})]}),e.jsx(C,{value:Math.min(o.totalScore*20,100),className:h("h-2",o.totalScore>3?"bg-red-900/20":"bg-green-900/20")})]})]}),e.jsxs("div",{className:"pt-4 border-t border-border/50 grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"bg-muted/30 p-3 rounded-lg",children:[e.jsx("p",{className:"text-xs text-muted-foreground mb-1",children:"Confidence"}),e.jsxs("p",{className:"text-lg font-bold text-primary",children:[(o.confidence*100).toFixed(0),"%"]})]}),e.jsxs("div",{className:"bg-muted/30 p-3 rounded-lg",children:[e.jsxs("p",{className:"text-xs text-muted-foreground mb-1 flex items-center gap-1",children:[e.jsx(ie,{className:"w-3 h-3"})," Latency"]}),e.jsxs("p",{className:"text-lg font-bold font-mono",children:[a.toFixed(1),"ms"]})]})]})]})}function qe({data:s,height:n=300}){const{theme:o}=E(),a=u.useMemo(()=>s.map((t,i)=>({...t,index:i,lifetime:t.death-t.birth})).sort((t,i)=>i.death-i.birth-(t.death-t.birth)),[s]);a.filter(t=>t.dimension===0),a.filter(t=>t.dimension===1),a.filter(t=>t.dimension===2);const l=Math.max(...s.map(t=>t.death),1);return e.jsxs("div",{className:"w-full h-full min-h-[300px] flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2 px-2",children:[e.jsx("h3",{className:"text-sm font-medium",children:"Persistence Barcode"}),e.jsxs("div",{className:"flex gap-2 text-xs",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"w-2 h-2 rounded-full bg-blue-500"})," H0"]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"w-2 h-2 rounded-full bg-green-500"})," H1"]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"w-2 h-2 rounded-full bg-orange-500"})," H2"]})]})]}),e.jsxs("div",{className:"flex-1 relative border-l border-b border-border/50 m-2",children:[e.jsx("svg",{width:"100%",height:"100%",className:"overflow-visible",children:a.map((t,i)=>{const d=i/a.length*100+"%",p=t.birth/l*100+"%",m=t.death/l*100+"%",r=t.dimension===0?"#3b82f6":t.dimension===1?"#22c55e":"#f97316";return e.jsxs("g",{className:"group cursor-pointer",children:[e.jsx("line",{x1:p,y1:d,x2:m,y2:d,stroke:r,strokeWidth:"4",strokeLinecap:"round",className:"opacity-70 group-hover:opacity-100 group-hover:stroke-[6px] transition-all"}),e.jsx("title",{children:`Dim ${t.dimension}: [${t.birth.toFixed(2)}, ${t.death.toFixed(2)}]`})]},t.id)})}),e.jsxs("div",{className:"absolute -bottom-6 left-0 right-0 flex justify-between text-xs text-muted-foreground",children:[e.jsx("span",{children:"0"}),e.jsx("span",{children:"Time →"}),e.jsx("span",{children:l.toFixed(1)})]})]})]})}function Ze({data:s}){const{theme:n}=E(),o=n==="dark",a=({active:l,payload:t})=>{if(l&&t&&t.length){const i=t[0].payload;return e.jsxs("div",{className:"bg-background/90 backdrop-blur border border-border p-2 rounded shadow-lg text-xs",children:[e.jsxs("p",{className:"font-bold mb-1",children:["Feature ",i.id]}),e.jsxs("p",{children:["Dimension: H",i.dimension]}),e.jsxs("p",{children:["Birth: ",i.birth.toFixed(3)]}),e.jsxs("p",{children:["Death: ",i.death.toFixed(3)]}),e.jsxs("p",{children:["Persistence: ",(i.death-i.birth).toFixed(3)]})]})}return null};return e.jsxs("div",{className:"w-full h-full min-h-[300px] flex flex-col",children:[e.jsx("div",{className:"flex items-center justify-between mb-2 px-2",children:e.jsx("h3",{className:"text-sm font-medium",children:"Birth-Death Plane"})}),e.jsx("div",{className:"flex-1",children:e.jsx(ne,{width:"100%",height:"100%",children:e.jsxs(le,{margin:{top:20,right:20,bottom:20,left:20},children:[e.jsx(oe,{type:"number",dataKey:"birth",name:"Birth",label:{value:"Birth Time",position:"bottom",offset:0,fontSize:12,fill:"currentColor"},tick:{fontSize:10},stroke:"currentColor",className:"text-muted-foreground"}),e.jsx(ce,{type:"number",dataKey:"death",name:"Death",label:{value:"Death Time",angle:-90,position:"left",offset:0,fontSize:12,fill:"currentColor"},tick:{fontSize:10},stroke:"currentColor",className:"text-muted-foreground"}),e.jsx(de,{content:e.jsx(a,{}),cursor:{strokeDasharray:"3 3"}}),e.jsx(me,{segment:[{x:0,y:0},{x:1,y:1}],stroke:o?"#475569":"#cbd5e1",strokeDasharray:"3 3"}),e.jsx(xe,{name:"Features",data:s,children:s.map((l,t)=>e.jsx(ue,{fill:l.dimension===0?"#3b82f6":l.dimension===1?"#22c55e":"#f97316",fillOpacity:.6,strokeWidth:1},`cell-${t}`))})]})})})]})}function Ye({data:s}){const[n,o]=u.useState(0),[a,l]=u.useState(!1),t=u.useRef(),i=Math.max(...s.map(r=>r.death),1),d=r=>{o(c=>{const f=c+.005;return f>1.1?0:f}),t.current=requestAnimationFrame(d)};u.useEffect(()=>(a?t.current=requestAnimationFrame(d):t.current&&cancelAnimationFrame(t.current),()=>{t.current&&cancelAnimationFrame(t.current)}),[a]);const p=s.filter(r=>r.birth/i<=n&&r.death/i>=n),m=s.filter(r=>r.death/i<n);return e.jsxs("div",{className:"w-full h-full flex flex-col p-4 relative overflow-hidden",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4 z-10",children:[e.jsx("h3",{className:"text-sm font-medium",children:"Filtration Process"}),e.jsx("button",{onClick:()=>l(!a),className:"text-xs bg-primary/20 hover:bg-primary/30 text-primary px-2 py-1 rounded transition-colors",children:a?"Pause":"Play"})]}),e.jsxs("div",{className:"flex-1 relative border border-border/30 rounded-lg bg-slate-950/50 backdrop-blur-sm overflow-hidden",children:[e.jsxs("div",{className:"absolute inset-0 flex items-center justify-center",children:[e.jsx(T,{children:p.map(r=>e.jsx(g.div,{layoutId:r.id,initial:{scale:0,opacity:0},animate:{scale:1,opacity:.8},exit:{scale:.5,opacity:0},className:`absolute rounded-full border-2 ${r.dimension===0?"border-blue-500 bg-blue-500/20":r.dimension===1?"border-green-500 bg-green-500/20":"border-orange-500 bg-orange-500/20"}`,style:{left:`${parseInt(r.id.slice(-4),16)%80+10}%`,top:`${parseInt(r.id.slice(-3),16)%80+10}%`,width:"40px",height:"40px"}},r.id))}),m.map(r=>e.jsx("div",{className:`absolute rounded-full border ${r.dimension===0?"border-blue-900/30":r.dimension===1?"border-green-900/30":"border-orange-900/30"}`,style:{left:`${parseInt(r.id.slice(-4),16)%80+10}%`,top:`${parseInt(r.id.slice(-3),16)%80+10}%`,width:"40px",height:"40px",opacity:.2}},r.id))]}),e.jsx("div",{className:"absolute bottom-0 left-0 right-0 bg-primary/10 border-t border-primary/30 transition-all duration-75 ease-linear pointer-events-none",style:{height:`${n*100}%`}}),e.jsxs("div",{className:"absolute top-2 right-2 font-mono text-xs text-muted-foreground",children:["ε = ",n.toFixed(3)]})]})]})}const Xe=()=>{const{persistenceDiagram:s}=w();return e.jsx(qe,{data:s})},Je=()=>{const{persistenceDiagram:s}=w();return e.jsx(Ze,{data:s})},Qe=()=>{const{persistenceDiagram:s}=w();return e.jsx(Ye,{data:s})};function os(){const[s,n]=u.useState(["feed","timeline","threats","topology"]),[o,a]=u.useState(!1),[l,t]=u.useState(!0),{toast:i}=we();u.useEffect(()=>{const x=setTimeout(()=>t(!1),1500);return()=>clearTimeout(x)},[]);const d=he(A(Ne),A(ve,{coordinateGetter:ye})),p=x=>{const{active:j,over:v}=x;j.id!==v.id&&n(S=>{const D=S.indexOf(j.id),P=S.indexOf(v.id);return be(S,D,P)})},m=x=>{n(s.filter(j=>j!==x)),i({title:"Widget Removed",description:"The widget has been removed from your dashboard."})},r=x=>{s.includes(x)||(n([...s,x]),a(!1),i({title:"Widget Added",description:"The widget has been added to your dashboard."}))},c=x=>{const j=L.find(v=>v.id===x);return j?j.title:"Widget"},f=x=>{if(l)return e.jsx(Ve,{});switch(x){case"feed":return e.jsx($e,{className:"h-full"});case"timeline":return e.jsx(Oe,{});case"threats":return e.jsx(Ie,{});case"topology":return e.jsx(Ee,{});case"tda-stats":return e.jsx(Ue,{});case"barcode":return e.jsx(Xe,{});case"birth-death":return e.jsx(Je,{});case"filtration":return e.jsx(Qe,{});default:return null}};return e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsx(ze,{}),e.jsxs("main",{className:"pt-20 pb-8 px-4 sm:px-6 lg:px-8 max-w-[1800px] mx-auto transition-all duration-300 md:pl-[280px]",children:[e.jsxs("div",{className:"flex justify-between items-center mb-8",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Dashboard"}),e.jsx("p",{className:"text-muted-foreground text-sm mt-1",children:"Real-time monitoring and anomaly detection."})]}),e.jsxs(y,{size:"sm",onClick:()=>a(!0),children:[e.jsx(z,{className:"w-4 h-4 mr-2"})," Add Widget"]})]}),e.jsx(pe,{sensors:d,collisionDetection:fe,onDragEnd:p,children:e.jsx(ge,{items:s,strategy:je,children:e.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 gap-6 auto-rows-[400px]","data-tour":"dashboard-widgets",children:s.map(x=>e.jsx(Ge,{id:x,title:c(x),onRemove:m,className:h(x==="timeline"?"lg:col-span-2":"","stagger-item"),children:f(x)},x))})})}),e.jsx(He,{open:o,onOpenChange:a,onAddWidget:r,activeWidgets:s}),e.jsx(Ke,{})]})]})}export{os as default};
