import{r as o,j as e,g as _,bg as Q,bh as Y,bi as P,bj as O,bk as J,bl as H,bm as ee,bn as te,bo as se,bp as ae,bq as ne,br as ie,bs as K,bt as re,bu as W,bv as V,bw as Z,o as G,G as F,b0 as oe,bx as le}from"./vendor-BJtIU4cE.js";import{N as ce}from"./Navigation-CchaNxGk.js";import{u as M,c as S,e as de}from"./index-DT2D_i0V.js";import{C as R,a as T,b as U,d as D}from"./card-CjP5KoZO.js";import{S as A}from"./switch-CwlCip_Z.js";import{L}from"./label-3v_expCV.js";import{B as ue}from"./dialog-B7IIvyeJ.js";import"./button-ZZWTDpQH.js";const E={US:{lat:39.8283,lng:-98.5795,name:"United States"},GB:{lat:55.3781,lng:-3.436,name:"United Kingdom"},DE:{lat:51.1657,lng:10.4515,name:"Germany"},FR:{lat:46.2276,lng:2.2137,name:"France"},ES:{lat:40.4637,lng:-3.7492,name:"Spain"},IT:{lat:41.8719,lng:12.5674,name:"Italy"},CN:{lat:35.8617,lng:104.1954,name:"China"},JP:{lat:36.2048,lng:138.2529,name:"Japan"},IN:{lat:20.5937,lng:78.9629,name:"India"},RU:{lat:61.524,lng:105.3188,name:"Russia"},BR:{lat:-14.235,lng:-51.9253,name:"Brazil"},CA:{lat:56.1304,lng:-106.3468,name:"Canada"},AU:{lat:-25.2744,lng:133.7751,name:"Australia"},KR:{lat:35.9078,lng:127.7669,name:"South Korea"},MX:{lat:23.6345,lng:-102.5528,name:"Mexico"},NL:{lat:52.1326,lng:5.2913,name:"Netherlands"},SE:{lat:60.1282,lng:18.6435,name:"Sweden"},PL:{lat:51.9194,lng:19.1451,name:"Poland"},AR:{lat:-38.4161,lng:-63.6167,name:"Argentina"},ZA:{lat:-30.5595,lng:22.9375,name:"South Africa"}},me={"en.wikipedia.org":"US","de.wikipedia.org":"DE","fr.wikipedia.org":"FR","es.wikipedia.org":"ES","it.wikipedia.org":"IT","ja.wikipedia.org":"JP","zh.wikipedia.org":"CN","ru.wikipedia.org":"RU","pt.wikipedia.org":"BR","nl.wikipedia.org":"NL","pl.wikipedia.org":"PL","sv.wikipedia.org":"SE","ko.wikipedia.org":"KR"};function g(s){try{const n=new URL(s.serverUrl).hostname,h=me[n]||"US",l=E[h];if(l){const x=(Math.random()-.5)*10,i=(Math.random()-.5)*10;return{lat:l.lat+x,lng:l.lng+i,country:l.name,countryCode:h}}}catch(t){console.warn("Failed to extract geo from event",t)}return null}function he(s,t,n=50){const h=[];for(let l=0;l<=n;l++){const x=l/n,i=s.lat+(t.lat-s.lat)*x,m=s.lng+(t.lng-s.lng)*x,a=Math.sin(x*Math.PI)*.2;h.push([m,i+a])}return h}function pe(s){const t={};return s.forEach(n=>{const h=g(n);h&&(t[h.countryCode]=(t[h.countryCode]||0)+1)}),t}function xe(s,t){const n=s/t;return n>.75?"#dc2626":n>.5?"#f97316":n>.25?"#fbbf24":"#34d399"}function ge({className:s}){const{events:t}=M(),[n,h]=o.useState([]),[l,x]=o.useState([]),[i,m]=o.useState([]),[a,c]=o.useState(!0),[d,b]=o.useState(!1),[y,X]=o.useState(!0);o.useEffect(()=>{const u=t.slice(0,100).map(r=>{const p=g(r);return p?{id:r.id,position:[p.lat,p.lng],event:r,geo:p,timestamp:r.timestamp.getTime()}:null}).filter(r=>r!==null);h(u);const j=new Map;t.forEach(r=>{const p=g(r);if(!p)return;const f=`${Math.round(p.lat)},${Math.round(p.lng)}`,v=j.get(f);v?v.count++:j.set(f,{lat:Math.round(p.lat),lng:Math.round(p.lng),count:1})});const k=Array.from(j.values()).map(r=>({lat:r.lat,lng:r.lng,intensity:r.count}));x(k);const N=[];for(let r=0;r<Math.min(t.length-1,50);r++){const p=g(t[r]),f=g(t[r+1]);if(p&&f&&p.countryCode!==f.countryCode){const v=he(p,f,30);N.push({id:`${t[r].id}-${t[r+1].id}`,path:v,color:t[r].bot?"#818cf8":"#34d399"})}}m(N)},[t]);const z=Math.max(...l.map(u=>u.intensity),1);return e.jsxs("div",{className:`relative ${s}`,children:[e.jsxs(R,{className:"absolute top-4 right-4 z-[1000] p-4 bg-slate-900/90 border-slate-700 backdrop-blur-md w-64",children:[e.jsx("h3",{className:"text-sm font-semibold text-slate-200 mb-3",children:"Map Layers"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(_,{className:"w-4 h-4 text-emerald-500"}),e.jsx(L,{className:"text-xs text-slate-300",children:"Live Edits"})]}),e.jsx(A,{checked:a,onCheckedChange:c})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Q,{className:"w-4 h-4 text-red-500"}),e.jsx(L,{className:"text-xs text-slate-300",children:"Heatmap"})]}),e.jsx(A,{checked:d,onCheckedChange:b})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Y,{className:"w-4 h-4 text-indigo-500"}),e.jsx(L,{className:"text-xs text-slate-300",children:"Flow Arcs"})]}),e.jsx(A,{checked:y,onCheckedChange:X})]})]})]}),e.jsxs(P,{center:[20,0],zoom:2,style:{height:"100%",width:"100%"},className:"rounded-lg z-0",children:[e.jsx(O,{attribution:'© <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> © <a href="https://carto.com/attributions">CARTO</a>',url:"https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png"}),a&&n.map(u=>e.jsx(J,{center:u.position,radius:6,pathOptions:{fillColor:u.event.bot?"#6366f1":"#10b981",fillOpacity:.7,color:"#fff",weight:1},children:e.jsx(H,{children:e.jsxs("div",{className:"text-sm",children:[e.jsx("div",{className:"font-semibold",children:u.event.title}),e.jsxs("div",{className:"text-xs text-muted-foreground mt-1",children:["By: ",u.event.user]}),e.jsx("div",{className:"text-xs text-muted-foreground",children:u.geo.country})]})})},u.id)),d&&l.map((u,j)=>{const k=u.intensity/z,N=5e4*(u.intensity/z+.2);return e.jsx(ee,{center:[u.lat,u.lng],radius:N,pathOptions:{fillColor:"#ef4444",fillOpacity:k*.5,color:"transparent",weight:0}},`heat-${j}`)}),y&&i.map(u=>e.jsx(te,{positions:u.path,pathOptions:{color:u.color,weight:1.5,opacity:.5}},u.id))]})]})}function I({className:s}){const{events:t}=M(),[n,h]=o.useState({}),[l,x]=o.useState(1);o.useEffect(()=>{const a=pe(t);h(a),x(Math.max(...Object.values(a),1))},[t]);const m={type:"FeatureCollection",features:Object.entries(n).map(([a,c])=>{const d=E[a];return d?{type:"Feature",properties:{name:d.name,code:a,count:c},geometry:{type:"Point",coordinates:[d.lng,d.lat]}}:null}).filter(Boolean)};return e.jsx("div",{className:s,children:e.jsxs("div",{className:"p-4 bg-card rounded-lg border",children:[e.jsx("h3",{className:"text-sm font-semibold mb-3",children:"Top Countries by Edit Volume"}),e.jsx("div",{className:"space-y-2 mb-4",children:Object.entries(n).sort(([,a],[,c])=>c-a).slice(0,5).map(([a,c])=>{const d=E[a];return d?e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{children:d.name}),e.jsx("span",{className:"font-mono text-primary",children:c})]},a):null})}),e.jsxs(P,{center:[20,0],zoom:2,style:{height:"400px",width:"100%"},className:"rounded-lg",children:[e.jsx(O,{attribution:'© <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a>',url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"}),e.jsx(se,{data:m,pointToLayer:(a,c)=>{const d=a.properties.count,b=10+d/l*40;return ae.circleMarker(c,{radius:b,fillColor:xe(d,l),fillOpacity:.7,color:"#fff",weight:2})},onEachFeature:(a,c)=>{c.bindPopup(`
                <b>${a.properties.name}</b><br/>
                Edits: ${a.properties.count}
              `)}})]})]})})}const B={en:"#3b82f6",de:"#eab308",fr:"#8b5cf6",es:"#f97316",it:"#10b981",ja:"#ec4899",zh:"#ef4444",ru:"#14b8a6",pt:"#06b6d4"};function $({className:s}){const{events:t}=M(),[n,h]=o.useState({}),[l,x]=o.useState([]);return o.useEffect(()=>{const i={},m=[];t.slice(0,200).forEach(a=>{const c=g(a);if(!c)return;const d=a.wiki.substring(0,2);i[d]=(i[d]||0)+1,m.push({position:[c.lat,c.lng],lang:d,event:a})}),h(i),x(m)},[t]),e.jsx("div",{className:s,children:e.jsxs("div",{className:"p-4 bg-card rounded-lg border",children:[e.jsx("h3",{className:"text-sm font-semibold mb-3",children:"Wiki Language Clusters"}),e.jsx("div",{className:"flex flex-wrap gap-2 mb-3",children:Object.entries(n).sort(([,i],[,m])=>m-i).slice(0,8).map(([i,m])=>e.jsxs(ue,{variant:"secondary",style:{backgroundColor:B[i]+"33"},children:[i.toUpperCase(),": ",m]},i))}),e.jsxs(P,{center:[20,0],zoom:2,style:{height:"400px",width:"100%"},className:"rounded-lg",children:[e.jsx(O,{attribution:"© OpenStreetMap",url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"}),l.map((i,m)=>e.jsx(J,{center:i.position,radius:5,pathOptions:{fillColor:B[i.lang]||"#gray",fillOpacity:.7,color:"#fff",weight:1},children:e.jsx(H,{children:e.jsxs("div",{className:"text-xs",children:[e.jsx("div",{className:"font-semibold",children:i.event.title}),e.jsxs("div",{className:"text-muted-foreground",children:["Language: ",i.lang.toUpperCase()]})]})})},m))]})]})})}function fe(){const{events:s}=M(),t=o.useRef(null),[n,h]=o.useState(new Float32Array(0));return o.useEffect(()=>{const l=[];s.slice(0,500).forEach(x=>{const i=g(x);if(!i)return;const m=(90-i.lat)*(Math.PI/180),a=(i.lng+180)*(Math.PI/180),c=2.1,d=-(c*Math.sin(m)*Math.cos(a)),b=c*Math.cos(m),y=c*Math.sin(m)*Math.sin(a);l.push(d,b,y)}),h(new Float32Array(l))},[s]),K(()=>{t.current&&(t.current.rotation.y+=.001)}),e.jsxs("points",{ref:t,children:[e.jsx("bufferGeometry",{children:e.jsx("bufferAttribute",{attach:"attributes-position",count:n.length/3,array:n,itemSize:3})}),e.jsx("pointsMaterial",{size:.05,color:"#10b981",sizeAttenuation:!0,transparent:!0,opacity:.8})]})}function be(){const s=o.useRef(null);return K(()=>{s.current&&(s.current.rotation.y+=.002)}),e.jsxs("mesh",{ref:s,children:[e.jsx("sphereGeometry",{args:[2,64,64]}),e.jsx("meshStandardMaterial",{color:"#1e293b",wireframe:!0,opacity:.1,transparent:!0})]})}function je({className:s}){return e.jsx("div",{className:s,children:e.jsxs("div",{className:"p-4 bg-card rounded-lg border",children:[e.jsx("h3",{className:"text-sm font-semibold mb-3",children:"3D Globe Visualization"}),e.jsx("div",{style:{height:"500px",width:"100%"},className:"rounded-lg overflow-hidden bg-slate-950",children:e.jsxs(ne,{camera:{position:[0,0,5],fov:50},children:[e.jsx("ambientLight",{intensity:.5}),e.jsx("pointLight",{position:[10,10,10]}),e.jsx(be,{}),e.jsx(fe,{}),e.jsx(ie,{enableZoom:!0,enablePan:!1,minDistance:3,maxDistance:8})]})})]})})}const ye=re,q=o.forwardRef(({className:s,...t},n)=>e.jsx(W,{ref:n,className:S("inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",s),...t}));q.displayName=W.displayName;const w=o.forwardRef(({className:s,...t},n)=>e.jsx(V,{ref:n,className:S("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",s),...t}));w.displayName=V.displayName;const C=o.forwardRef(({className:s,...t},n)=>e.jsx(Z,{ref:n,className:S("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",s),...t}));C.displayName=Z.displayName;const Le=()=>{const{isSidebarCollapsed:s}=de();return e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsx(ce,{}),e.jsxs("main",{className:S("pt-20 pb-8 px-4 sm:px-6 lg:px-8 max-w-[1800px] mx-auto transition-all duration-300",s?"md:pl-[80px]":"md:pl-[280px]"),children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs(G.h1,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},className:"text-2xl font-bold flex items-center gap-2",children:[e.jsx(F,{className:"w-6 h-6 text-primary"}),"Geographic Intelligence"]}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"Global visualization of Wikipedia edit activity and topological structures."})]}),e.jsxs(ye,{defaultValue:"map",className:"space-y-6",children:[e.jsx("div",{className:"flex justify-between items-center",children:e.jsxs(q,{className:"bg-slate-900 border border-slate-800",children:[e.jsxs(w,{value:"map",className:"gap-2",children:[e.jsx(oe,{className:"w-4 h-4"})," 2D Map"]}),e.jsxs(w,{value:"globe",className:"gap-2",children:[e.jsx(F,{className:"w-4 h-4"})," 3D Globe"]}),e.jsxs(w,{value:"analytics",className:"gap-2",children:[e.jsx(le,{className:"w-4 h-4"})," Analytics"]})]})}),e.jsx(C,{value:"map",className:"space-y-6",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-4 gap-6 h-[700px]",children:[e.jsx(G.div,{initial:{opacity:0,scale:.98},animate:{opacity:1,scale:1},className:"lg:col-span-3 h-full bg-slate-900 rounded-xl border border-slate-800 overflow-hidden shadow-2xl relative",children:e.jsx(ge,{className:"h-full w-full"})}),e.jsxs("div",{className:"space-y-6 h-full overflow-y-auto pr-2",children:[e.jsx(I,{}),e.jsx($,{})]})]})}),e.jsx(C,{value:"globe",children:e.jsx("div",{className:"h-[700px] bg-slate-900 rounded-xl border border-slate-800 overflow-hidden",children:e.jsx(je,{})})}),e.jsx(C,{value:"analytics",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs(R,{className:"bg-slate-900 border-slate-800",children:[e.jsx(T,{children:e.jsx(U,{children:"Regional Activity"})}),e.jsx(D,{children:e.jsx(I,{})})]}),e.jsxs(R,{className:"bg-slate-900 border-slate-800",children:[e.jsx(T,{children:e.jsx(U,{children:"Language Distribution"})}),e.jsx(D,{children:e.jsx($,{})})]})]})})]})]})]})};export{Le as default};
