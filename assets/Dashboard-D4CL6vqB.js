import{a9 as k,j as e,o as y,aa as P,ab as Y,U as X,ac as J,ad as Q,ae as ee,r as f,af as se,ag as te,ah as ae,ai as re,aj as ie,ak as ne,X as le,g as I,al as D,am as oe,an as W,ao as ce,f as R,ap as de,aq as me,ar as xe,as as M,at as ue,au as he,av as B,aw as pe,ax as fe,Z as ge,b as $,ay as O,az as je,aA as _,aB as G,aC as H,aD as be,aE as ye,aF as Ne,aG as ve,aH as we,aI as Se,z as Ce,y as ke,aJ as Ae,aK as L,aL as De,aM as Te,aN as Fe,aO as ze,aP as Ee,aQ as Ie,aR as We,aS as Le,aT as Pe}from"./vendor-DGrUDQ2I.js";import{B as S}from"./button-tSF00QVK.js";import{u as C,d as K,c as h,a as Re,e as Me}from"./index-wDoEtXv7.js";import{A as Be}from"./api-DnZfAAQS.js";import{S as $e,N as Oe}from"./Navigation-BCakuI71.js";import{B as V,D as _e,b as Ge,c as He,d as Ke,e as Ve,f as Ue,g as qe}from"./dialog-CBwJkRkz.js";import{T as Ze}from"./ThreatIntelCard-ClXPmIMV.js";import{P as Ye}from"./PersistenceDiagram-BWTv0FoF.js";import{C as T,a as F,b as z,d as E}from"./card-CsZyhY5H.js";const Xe=k.forwardRef(({event:s,index:o},l)=>{const a=s.delta&&s.delta>0?"text-success":s.delta&&s.delta<0?"text-critical":"text-muted-foreground",i=n=>{if(!n)return null;const x=n>0?"+":"";return Math.abs(n)>=1e3?`${x}${(n/1e3).toFixed(1)}K`:`${x}${n}`},t=()=>s.type==="new"?e.jsx(J,{className:"w-3 h-3"}):s.type==="categorize"?e.jsx(Q,{className:"w-3 h-3"}):e.jsx(ee,{className:"w-3 h-3"});return e.jsx(y.div,{ref:l,initial:{opacity:0,x:-20,height:0},animate:{opacity:1,x:0,height:"auto"},exit:{opacity:0,x:20,height:0},transition:{duration:.2,delay:o*.02},className:"border-b border-border/30 py-2 px-1 last:border-0",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("div",{className:h("p-1 rounded mt-0.5",s.type==="new"?"bg-success/10 text-success":"bg-primary/10 text-primary"),children:t()}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-1.5 mb-0.5",children:[e.jsx("span",{className:"text-xs font-medium truncate max-w-[180px]",title:s.title,children:s.title}),s.minor&&e.jsx(V,{variant:"outline",className:"text-[8px] px-1 py-0",children:"m"})]}),e.jsxs("div",{className:"flex items-center gap-2 text-[10px] text-muted-foreground",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[s.bot?e.jsx(Y,{className:"w-3 h-3"}):e.jsx(X,{className:"w-3 h-3"}),e.jsx("span",{className:"truncate max-w-[80px]",title:s.user,children:s.user})]}),e.jsx("span",{className:"opacity-50",children:"•"}),e.jsx("span",{className:"font-mono opacity-70",children:s.wiki.replace("wiki","")}),s.delta!==void 0&&s.delta!==0&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"opacity-50",children:"•"}),e.jsx("span",{className:h("font-mono font-medium",a),children:i(s.delta)})]})]})]}),e.jsx("span",{className:"text-[9px] text-muted-foreground shrink-0",children:s.timestamp.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",second:"2-digit"})})]})})});function Je({className:s,maxItems:o=15}){const{events:l,isConnected:a,eventsPerSecond:i}=C(),{recentEvents:t}=K(),[n,x]=k.useState([]),[p,d]=k.useState("all");k.useEffect(()=>{const m=t.map(j=>({id:j.id,type:"edit",title:j.content,user:j.source,timestamp:new Date(j.timestamp),wiki:j.type,bot:!0,minor:!1,delta:0,comment:""})),g=[...l,...m].sort((j,u)=>u.timestamp.getTime()-j.timestamp.getTime());g.length>0&&x(j=>{const u=[...g,...j].slice(0,50);return Array.from(new Map(u.map(b=>[b.id,b])).values()).sort((b,A)=>A.timestamp.getTime()-b.timestamp.getTime()).slice(0,50)})},[l,t]);const c=n.filter(m=>p==="all"?!0:p==="bot"?m.bot:p==="user"?!m.bot:!0).slice(0,o);return e.jsxs("div",{className:h("relative h-full flex flex-col",s),children:[e.jsxs("div",{className:"flex items-center justify-between mb-2 px-1 shrink-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm font-medium",children:"Live Feed"}),a&&e.jsxs(y.div,{className:"flex items-center gap-1 px-1.5 py-0.5 rounded-full bg-success/10 text-success text-[9px]",animate:{opacity:[.7,1,.7]},transition:{duration:2,repeat:1/0},children:[e.jsx("span",{className:"w-1.5 h-1.5 rounded-full bg-success"}),i,"/s"]})]}),e.jsxs("div",{className:"flex items-center gap-1 bg-slate-800/50 rounded-lg p-0.5",children:[e.jsx("button",{onClick:()=>d("all"),className:h("px-2 py-0.5 text-[10px] rounded transition-colors",p==="all"?"bg-primary/20 text-primary":"text-muted-foreground hover:text-foreground"),children:"All"}),e.jsx("button",{onClick:()=>d("user"),className:h("px-2 py-0.5 text-[10px] rounded transition-colors",p==="user"?"bg-primary/20 text-primary":"text-muted-foreground hover:text-foreground"),children:"User"}),e.jsx("button",{onClick:()=>d("bot"),className:h("px-2 py-0.5 text-[10px] rounded transition-colors",p==="bot"?"bg-primary/20 text-primary":"text-muted-foreground hover:text-foreground"),children:"Bot"})]})]}),e.jsx($e,{className:"flex-1 pr-2 -mr-2",children:e.jsx("div",{className:"pr-2",children:e.jsx(P,{mode:"popLayout",initial:!1,children:c.length>0?c.map((m,g)=>e.jsx(Xe,{event:m,index:g},m.id)):e.jsx(y.div,{initial:{opacity:0},animate:{opacity:1},className:"py-8 text-center text-muted-foreground",children:e.jsx("p",{className:"text-xs",children:a?"Waiting for events...":"Connect to see live edits"})})})})}),a&&c.length>0&&e.jsxs("div",{className:"mt-2 pt-2 border-t border-border/30 flex items-center justify-between text-[10px] text-muted-foreground shrink-0",children:[e.jsxs("span",{children:[c.filter(m=>m.bot).length," bot edits"]}),e.jsxs("span",{children:[c.filter(m=>m.type==="new").length," new articles"]})]})]})}function Qe({className:s}){var p;const{timeline:o,isConnected:l}=C(),a=f.useMemo(()=>o.length>0?o:Array.from({length:24},(d,r)=>({time:`${String(r).padStart(2,"0")}:00`,timestamp:new Date,value:.1+Math.random()*.1,anomaly:!1,eventCount:0})),[o]),i=Math.max(...a.map(d=>d.value),.1),t=100/(a.length-1),n=a.map((d,r)=>{const c=r*t,m=100-d.value/i*80;return`${r===0?"M":"L"} ${c} ${m}`}).join(" "),x=`${n} L 100 100 L 0 100 Z`;return e.jsxs("div",{className:h("relative bg-card/50 rounded-xl p-4 border border-border/50",s),children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm font-medium text-foreground",children:"Anomaly Timeline"}),l&&e.jsxs(y.div,{className:"flex items-center gap-1 px-2 py-0.5 rounded-full bg-success/10 text-success text-[10px]",animate:{opacity:[.7,1,.7]},transition:{duration:2,repeat:1/0},children:[e.jsx("span",{className:"w-1.5 h-1.5 rounded-full bg-success"}),"Live"]})]}),e.jsxs("div",{className:"flex gap-3 text-xs",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-anomaly"}),e.jsx("span",{className:"text-muted-foreground",children:"Warning"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-critical"}),e.jsx("span",{className:"text-muted-foreground",children:"Critical"})]})]})]}),e.jsxs("svg",{className:"w-full h-32",viewBox:"0 0 100 100",preserveAspectRatio:"none",children:[e.jsxs("defs",{children:[e.jsxs("linearGradient",{id:"areaGradient",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"0%",stopColor:"hsl(var(--primary))",stopOpacity:"0.3"}),e.jsx("stop",{offset:"100%",stopColor:"hsl(var(--primary))",stopOpacity:"0"})]}),e.jsxs("linearGradient",{id:"lineGradient",x1:"0",y1:"0",x2:"1",y2:"0",children:[e.jsx("stop",{offset:"0%",stopColor:"hsl(var(--primary))"}),e.jsx("stop",{offset:"50%",stopColor:"hsl(var(--primary-glow))"}),e.jsx("stop",{offset:"100%",stopColor:"hsl(var(--primary))"})]})]}),e.jsx("g",{opacity:"0.1",children:[25,50,75].map(d=>e.jsx("line",{x1:"0",y1:d,x2:"100",y2:d,stroke:"hsl(var(--foreground))",strokeWidth:"0.5"},d))}),e.jsx(y.path,{d:x,fill:"url(#areaGradient)",initial:{opacity:0},animate:{opacity:1},transition:{duration:1}}),e.jsx(y.path,{d:n,fill:"none",stroke:"url(#lineGradient)",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",initial:{pathLength:0},animate:{pathLength:1},transition:{duration:2,ease:"easeOut"}}),a.map((d,r)=>{if(!d.anomaly)return null;const c=r*t,m=100-d.value/i*80,g="severity"in d&&d.severity==="critical";return e.jsxs(y.g,{children:[e.jsx(y.circle,{cx:c||0,cy:m||0,r:"8",fill:g?"hsl(var(--critical))":"hsl(var(--anomaly))",opacity:"0.3",animate:{r:[8,15,8],opacity:[.3,0,.3]},transition:{duration:2,repeat:1/0}}),e.jsx(y.circle,{cx:c||0,cy:m||0,r:"4",fill:g?"hsl(var(--critical))":"hsl(var(--anomaly))",initial:{scale:0},animate:{scale:1},transition:{delay:r*.05+.5,type:"spring"}})]},r)}),a.length>0&&e.jsx(y.circle,{cx:100,cy:100-a[a.length-1].value/i*80,r:"4",fill:"hsl(var(--primary))",animate:{r:[4,6,4],opacity:[1,.7,1]},transition:{duration:1.5,repeat:1/0}})]}),e.jsx("div",{className:"flex justify-between mt-2 text-[10px] text-muted-foreground",children:a.filter((d,r)=>r%Math.max(1,Math.floor(a.length/6))===0).map((d,r)=>e.jsx("span",{children:d.time},r))}),l&&o.length>0&&e.jsxs("div",{className:"absolute bottom-4 right-4 text-[10px] text-muted-foreground bg-card/80 px-2 py-1 rounded",children:[((p=o[o.length-1])==null?void 0:p.eventCount)||0," events/interval"]})]})}function es({id:s,title:o,children:l,onRemove:a,className:i}){const{attributes:t,listeners:n,setNodeRef:x,transform:p,transition:d,isDragging:r}=se({id:s}),[c,m]=k.useState(!1),[g,j]=k.useState(!1),u={transform:te.Transform.toString(p),transition:d,zIndex:r||c?50:"auto",position:c?"fixed":"relative",top:c?0:"auto",left:c?0:"auto",right:c?0:"auto",bottom:c?0:"auto",width:c?"100vw":"auto",height:c?"100vh":"100%"},N=()=>{j(!0),setTimeout(()=>j(!1),1e3)},b=s==="feed"?"live-feed":s==="topology"?"topology-viz":void 0;return e.jsx("div",{ref:x,style:u,className:h("h-full",i,c&&"z-[100] p-4 bg-background/80 backdrop-blur-sm"),"data-tour":b,children:e.jsxs(T,{className:h("h-full flex flex-col overflow-hidden transition-all duration-200 glass-card",r&&"shadow-2xl ring-2 ring-primary/50 opacity-80 rotate-1",c&&"border-primary/20 shadow-2xl"),children:[e.jsxs(F,{className:"flex flex-row items-center justify-between space-y-0 pb-2 p-4 border-b border-slate-800/50",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[!c&&e.jsx("div",{...t,...n,className:"cursor-grab active:cursor-grabbing p-1 hover:bg-slate-800 rounded transition-colors",children:e.jsx(ae,{className:"w-4 h-4 text-slate-500"})}),e.jsxs(z,{className:"text-sm font-medium text-slate-200 flex items-center gap-2",children:[o,g&&e.jsx("span",{className:"text-xs text-muted-foreground animate-pulse",children:"Refreshing..."})]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(S,{variant:"ghost",size:"icon",className:h("h-6 w-6 text-slate-500 hover:text-primary",g&&"animate-spin text-primary"),onClick:N,children:e.jsx(re,{className:"w-3 h-3"})}),e.jsx(S,{variant:"ghost",size:"icon",className:"h-6 w-6 text-slate-500 hover:text-primary",onClick:()=>m(!c),children:c?e.jsx(ie,{className:"w-3 h-3"}):e.jsx(ne,{className:"w-3 h-3"})}),a&&!c&&e.jsx(S,{variant:"ghost",size:"icon",className:"h-6 w-6 text-slate-500 hover:text-red-400 hover:bg-red-500/10",onClick:()=>a(s),children:e.jsx(le,{className:"w-3 h-3"})})]})]}),e.jsx(E,{className:"flex-1 p-0 h-[calc(100%-60px)] relative overflow-hidden",children:l})]})})}const U=[{id:"feed",title:"Live Event Feed",description:"Real-time stream of Wikipedia edits and anomalies.",icon:I,defaultSize:"medium"},{id:"anomaly-score",title:"Anomaly Score",description:"Real-time unified anomaly score with topological breakdown.",icon:D,defaultSize:"medium"},{id:"timeline",title:"Anomaly Timeline",description:"Historical view of detected anomalies over time.",icon:oe,defaultSize:"large"},{id:"landscape",title:"Persistence Landscape",description:"Functional representation of topological features (H1).",icon:W,defaultSize:"medium"},{id:"threats",title:"Threat Intelligence",description:"Latest threat indicators and C2 server detections.",icon:D,defaultSize:"medium"},{id:"topology",title:"Persistence Diagram",description:"Topological data analysis visualization.",icon:ce,defaultSize:"medium"},{id:"tda-stats",title:"Advanced TDA Metrics",description:"Wasserstein distance, landscapes, and multi-modal anomaly scores.",icon:R,defaultSize:"medium"},{id:"barcode",title:"Persistence Barcode",description:"Interactive barcode showing feature lifetimes.",icon:de,defaultSize:"large"},{id:"birth-death",title:"Birth-Death Plane",description:"Scatter plot of topological features.",icon:me,defaultSize:"medium"},{id:"filtration",title:"Filtration Animation",description:"Visual timeline of the filtration process.",icon:xe,defaultSize:"medium"}];function ss({open:s,onOpenChange:o,onAddWidget:l,activeWidgets:a}){return e.jsx(_e,{open:s,onOpenChange:o,children:e.jsxs(Ge,{className:"sm:max-w-[500px] bg-slate-900 border-slate-800 text-slate-200",children:[e.jsxs(He,{children:[e.jsx(Ke,{children:"Add Widget"}),e.jsx(Ve,{className:"text-slate-400",children:"Choose a widget to add to your dashboard."})]}),e.jsx("div",{className:"grid gap-4 py-4",children:U.map(i=>{const t=a.includes(i.id);return e.jsxs("div",{className:h("flex items-start gap-4 p-3 rounded-lg border transition-all",t?"border-slate-800 bg-slate-800/50 opacity-50 cursor-not-allowed":"border-slate-700 bg-slate-800/30 hover:bg-slate-800 hover:border-primary/50 cursor-pointer"),onClick:()=>!t&&l(i.id),children:[e.jsx("div",{className:h("p-2 rounded-md",t?"bg-slate-700":"bg-primary/10 text-primary"),children:e.jsx(i.icon,{className:"w-5 h-5"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"text-sm font-medium leading-none mb-1.5",children:i.title}),e.jsx("p",{className:"text-xs text-slate-400 leading-snug",children:i.description})]}),!t&&e.jsx(S,{size:"icon",variant:"ghost",className:"h-8 w-8 text-primary",children:e.jsx(M,{className:"w-4 h-4"})})]},i.id)})}),e.jsx(Ue,{children:e.jsx(qe,{asChild:!0,children:e.jsx(S,{variant:"ghost",children:"Cancel"})})})]})})}function v({className:s,...o}){return e.jsx("div",{className:h("animate-pulse rounded-md bg-muted",s),...o})}function ts(){return e.jsxs("div",{className:"p-4 space-y-4 h-full",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx(v,{className:"h-12 w-12 rounded-full bg-slate-800"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{className:"h-4 w-[250px] bg-slate-800"}),e.jsx(v,{className:"h-4 w-[200px] bg-slate-800"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{className:"h-4 w-full bg-slate-800"}),e.jsx(v,{className:"h-4 w-full bg-slate-800"}),e.jsx(v,{className:"h-4 w-3/4 bg-slate-800"})]}),e.jsxs("div",{className:"pt-4 grid grid-cols-3 gap-4",children:[e.jsx(v,{className:"h-20 w-full bg-slate-800"}),e.jsx(v,{className:"h-20 w-full bg-slate-800"}),e.jsx(v,{className:"h-20 w-full bg-slate-800"})]})]})}function as(){const[s,o]=f.useState(!1);f.useEffect(()=>{if(localStorage.getItem("toposhape_tour_seen"))o(!0);else{const i=setTimeout(()=>{l()},2e3);return()=>clearTimeout(i)}},[]);const l=()=>{const a=ue({showProgress:!0,animate:!0,steps:[{element:"nav",popover:{title:"Welcome to TopoShape Insights",description:"Your advanced platform for topological data analysis and anomaly detection.",side:"right",align:"start"}},{element:'[data-tour="dashboard-widgets"]',popover:{title:"Interactive Dashboard",description:'Drag and drop widgets to customize your view. Click the "Add Widget" button to add more.',side:"bottom",align:"start"}},{element:'[data-tour="theme-toggle"]',popover:{title:"Theme & Customization",description:"Switch between Dark and Light modes here. Use Cmd+K to open the Command Palette for quick actions.",side:"bottom",align:"end"}},{element:'[data-tour="live-feed"]',popover:{title:"Real-time Feed",description:"Watch live events stream in. TDA algorithms process these in real-time to detect anomalies.",side:"left",align:"start"}},{element:'[data-tour="topology-viz"]',popover:{title:"Topological Analysis",description:"Visualize persistence diagrams and Betti numbers to understand the shape of your data.",side:"left",align:"start"}}],onDestroyStarted:()=>{(!a.hasNextStep()||confirm("Are you sure you want to stop the tour?"))&&(a.destroy(),localStorage.setItem("toposhape_tour_seen","true"),o(!0))}});a.drive()};return e.jsx(S,{variant:"ghost",size:"icon",className:"fixed bottom-4 right-4 z-50 rounded-full w-10 h-10 bg-primary/10 text-primary hover:bg-primary/20 shadow-lg backdrop-blur-sm border border-primary/20",onClick:l,title:"Start Tour",children:e.jsx(he,{className:"w-5 h-5"})})}function rs(s){const[o,l]=f.useState(null),a=f.useRef(null),i=f.useRef(0),t=f.useRef(!1);return f.useEffect(()=>(a.current=new Worker(new URL("/WINTER-2026/assets/tda.worker-1-1pGS40.js",import.meta.url),{type:"module"}),a.current.onmessage=n=>{const{type:x,payload:p}=n.data;x==="RESULT"?(l(p),t.current=!1):x==="ERROR"&&(console.error("TDA Worker Error:",p.message),t.current=!1)},a.current.postMessage({type:"INIT",payload:{windowSize:50}}),()=>{var n;(n=a.current)==null||n.terminate()}),[]),f.useEffect(()=>{var x;const n=Date.now();n-i.current<2e3||t.current||s.length<10||(t.current=!0,i.current=n,(x=a.current)==null||x.postMessage({type:"ANALYZE",payload:{events:s,windowMs:3e4}}))},[s]),o}const w=f.forwardRef(({className:s,value:o,indicatorClassName:l,...a},i)=>e.jsx(B,{ref:i,className:h("relative h-4 w-full overflow-hidden rounded-full bg-secondary",s),...a,children:e.jsx(pe,{className:h("h-full w-full flex-1 bg-primary transition-all",l),style:{transform:`translateX(-${100-(o||0)}%)`}})}));w.displayName=B.displayName;function is(){const{events:s}=C(),o=rs(s);if(!o)return e.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-muted-foreground space-y-2",children:[e.jsx(I,{className:"w-8 h-8 animate-pulse text-primary/50"}),e.jsx("p",{className:"text-sm",children:"Initializing TDA Engine..."})]});const{score:l,processingTime:a}=o,i=l.isAnomaly;return e.jsxs("div",{className:"p-4 space-y-6 h-full overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[i?e.jsx(D,{className:"w-5 h-5 text-red-500 animate-pulse"}):e.jsx(fe,{className:"w-5 h-5 text-green-500"}),e.jsx("span",{className:"font-medium text-sm",children:"System Status"})]}),e.jsx(V,{variant:i?"destructive":"outline",className:h(i?"animate-pulse":"bg-green-500/10 text-green-500 border-green-500/20"),children:i?"ANOMALY DETECTED":"STABLE"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-xs",children:[e.jsxs("span",{className:"text-muted-foreground flex items-center gap-1",children:[e.jsx(I,{className:"w-3 h-3"})," Wasserstein Distance"]}),e.jsx("span",{className:"font-mono",children:l.components.wasserstein.toFixed(2)})]}),e.jsx(w,{value:Math.min(l.components.wasserstein*10,100),className:"h-1.5"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-xs",children:[e.jsxs("span",{className:"text-muted-foreground flex items-center gap-1",children:[e.jsx(R,{className:"w-3 h-3"})," Landscape Norm (Z-Score)"]}),e.jsx("span",{className:"font-mono",children:l.components.landscape.toFixed(2)})]}),e.jsx(w,{value:Math.min(l.components.landscape*20,100),className:"h-1.5"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-xs",children:[e.jsx("span",{className:"text-muted-foreground",children:"Combined Anomaly Score"}),e.jsx("span",{className:h("font-mono font-bold",l.totalScore>3?"text-red-400":"text-green-400"),children:l.totalScore.toFixed(2)})]}),e.jsx(w,{value:Math.min(l.totalScore*20,100),className:h("h-2",l.totalScore>3?"bg-red-900/20":"bg-green-900/20")})]})]}),e.jsxs("div",{className:"pt-4 border-t border-border/50 grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"bg-muted/30 p-3 rounded-lg",children:[e.jsx("p",{className:"text-xs text-muted-foreground mb-1",children:"Confidence"}),e.jsxs("p",{className:"text-lg font-bold text-primary",children:[(l.confidence*100).toFixed(0),"%"]})]}),e.jsxs("div",{className:"bg-muted/30 p-3 rounded-lg",children:[e.jsxs("p",{className:"text-xs text-muted-foreground mb-1 flex items-center gap-1",children:[e.jsx(ge,{className:"w-3 h-3"})," Latency"]}),e.jsxs("p",{className:"text-lg font-bold font-mono",children:[a.toFixed(1),"ms"]})]})]})]})}function ns({data:s,height:o=300}){const{theme:l}=$(),a=f.useMemo(()=>s.map((t,n)=>({...t,index:n,lifetime:t.death-t.birth})).sort((t,n)=>n.death-n.birth-(t.death-t.birth)),[s]);a.filter(t=>t.dimension===0),a.filter(t=>t.dimension===1),a.filter(t=>t.dimension===2);const i=Math.max(...s.map(t=>t.death),1);return e.jsxs("div",{className:"w-full h-full min-h-[300px] flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2 px-2",children:[e.jsx("h3",{className:"text-sm font-medium",children:"Persistence Barcode"}),e.jsxs("div",{className:"flex gap-2 text-xs",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"w-2 h-2 rounded-full bg-blue-500"})," H0"]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"w-2 h-2 rounded-full bg-green-500"})," H1"]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"w-2 h-2 rounded-full bg-orange-500"})," H2"]})]})]}),e.jsxs("div",{className:"flex-1 relative border-l border-b border-border/50 m-2",children:[e.jsx("svg",{width:"100%",height:"100%",className:"overflow-visible",children:a.map((t,n)=>{const x=n/a.length*100+"%",p=t.birth/i*100+"%",d=t.death/i*100+"%",r=t.dimension===0?"#3b82f6":t.dimension===1?"#22c55e":"#f97316";return e.jsxs("g",{className:"group cursor-pointer",children:[e.jsx("line",{x1:p,y1:x,x2:d,y2:x,stroke:r,strokeWidth:"4",strokeLinecap:"round",className:"opacity-70 group-hover:opacity-100 group-hover:stroke-[6px] transition-all"}),e.jsx("title",{children:`Dim ${t.dimension}: [${t.birth.toFixed(2)}, ${t.death.toFixed(2)}]`})]},t.id)})}),e.jsxs("div",{className:"absolute -bottom-6 left-0 right-0 flex justify-between text-xs text-muted-foreground",children:[e.jsx("span",{children:"0"}),e.jsx("span",{children:"Time →"}),e.jsx("span",{children:i.toFixed(1)})]})]})]})}function ls({data:s}){const{theme:o}=$(),l=o==="dark",a=({active:i,payload:t})=>{if(i&&t&&t.length){const n=t[0].payload;return e.jsxs("div",{className:"bg-background/90 backdrop-blur border border-border p-2 rounded shadow-lg text-xs",children:[e.jsxs("p",{className:"font-bold mb-1",children:["Feature ",n.id]}),e.jsxs("p",{children:["Dimension: H",n.dimension]}),e.jsxs("p",{children:["Birth: ",n.birth.toFixed(3)]}),e.jsxs("p",{children:["Death: ",n.death.toFixed(3)]}),e.jsxs("p",{children:["Persistence: ",(n.death-n.birth).toFixed(3)]})]})}return null};return e.jsxs("div",{className:"w-full h-full min-h-[300px] flex flex-col",children:[e.jsx("div",{className:"flex items-center justify-between mb-2 px-2",children:e.jsx("h3",{className:"text-sm font-medium",children:"Birth-Death Plane"})}),e.jsx("div",{className:"flex-1",children:e.jsx(O,{width:"100%",height:"100%",children:e.jsxs(je,{margin:{top:20,right:20,bottom:20,left:20},children:[e.jsx(_,{type:"number",dataKey:"birth",name:"Birth",label:{value:"Birth Time",position:"bottom",offset:0,fontSize:12,fill:"currentColor"},tick:{fontSize:10},stroke:"currentColor",className:"text-muted-foreground"}),e.jsx(G,{type:"number",dataKey:"death",name:"Death",label:{value:"Death Time",angle:-90,position:"left",offset:0,fontSize:12,fill:"currentColor"},tick:{fontSize:10},stroke:"currentColor",className:"text-muted-foreground"}),e.jsx(H,{content:e.jsx(a,{}),cursor:{strokeDasharray:"3 3"}}),e.jsx(be,{segment:[{x:0,y:0},{x:1,y:1}],stroke:l?"#475569":"#cbd5e1",strokeDasharray:"3 3"}),e.jsx(ye,{name:"Features",data:s,children:s.map((i,t)=>e.jsx(Ne,{fill:i.dimension===0?"#3b82f6":i.dimension===1?"#22c55e":"#f97316",fillOpacity:.6,strokeWidth:1},`cell-${t}`))})]})})})]})}function os({data:s}){const[o,l]=f.useState(0),[a,i]=f.useState(!1),t=f.useRef(),n=Math.max(...s.map(r=>r.death),1),x=r=>{l(c=>{const m=c+.005;return m>1.1?0:m}),t.current=requestAnimationFrame(x)};f.useEffect(()=>(a?t.current=requestAnimationFrame(x):t.current&&cancelAnimationFrame(t.current),()=>{t.current&&cancelAnimationFrame(t.current)}),[a]);const p=s.filter(r=>r.birth/n<=o&&r.death/n>=o),d=s.filter(r=>r.death/n<o);return e.jsxs("div",{className:"w-full h-full flex flex-col p-4 relative overflow-hidden",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4 z-10",children:[e.jsx("h3",{className:"text-sm font-medium",children:"Filtration Process"}),e.jsx("button",{onClick:()=>i(!a),className:"text-xs bg-primary/20 hover:bg-primary/30 text-primary px-2 py-1 rounded transition-colors",children:a?"Pause":"Play"})]}),e.jsxs("div",{className:"flex-1 relative border border-border/30 rounded-lg bg-slate-950/50 backdrop-blur-sm overflow-hidden",children:[e.jsxs("div",{className:"absolute inset-0 flex items-center justify-center",children:[e.jsx(P,{children:p.map(r=>e.jsx(y.div,{layoutId:r.id,initial:{scale:0,opacity:0},animate:{scale:1,opacity:.8},exit:{scale:.5,opacity:0},className:`absolute rounded-full border-2 ${r.dimension===0?"border-blue-500 bg-blue-500/20":r.dimension===1?"border-green-500 bg-green-500/20":"border-orange-500 bg-orange-500/20"}`,style:{left:`${parseInt(r.id.slice(-4),16)%80+10}%`,top:`${parseInt(r.id.slice(-3),16)%80+10}%`,width:"40px",height:"40px"}},r.id))}),d.map(r=>e.jsx("div",{className:`absolute rounded-full border ${r.dimension===0?"border-blue-900/30":r.dimension===1?"border-green-900/30":"border-orange-900/30"}`,style:{left:`${parseInt(r.id.slice(-4),16)%80+10}%`,top:`${parseInt(r.id.slice(-3),16)%80+10}%`,width:"40px",height:"40px",opacity:.2}},r.id))]}),e.jsx("div",{className:"absolute bottom-0 left-0 right-0 bg-primary/10 border-t border-primary/30 transition-all duration-75 ease-linear pointer-events-none",style:{height:`${o*100}%`}}),e.jsxs("div",{className:"absolute top-2 right-2 font-mono text-xs text-muted-foreground",children:["ε = ",o.toFixed(3)]})]})]})}function cs(){const{analysisResult:s}=C(),o=f.useMemo(()=>{var i;if(!((i=s==null?void 0:s.topology_features)!=null&&i.landscape))return[];const{x:l,y:a}=s.topology_features.landscape;return l.map((t,n)=>({t,lambda:a[n]}))},[s]);return o.length?e.jsxs(T,{className:"h-full bg-slate-900 border-slate-800",children:[e.jsx(F,{className:"pb-2",children:e.jsxs(z,{className:"flex items-center gap-2 text-slate-100",children:[e.jsx(W,{className:"w-5 h-5 text-primary"}),"Persistence Landscape (H1)"]})}),e.jsx(E,{children:e.jsx("div",{className:"h-[200px] w-full",children:e.jsx(O,{width:"100%",height:"100%",children:e.jsxs(ve,{data:o,children:[e.jsx("defs",{children:e.jsxs("linearGradient",{id:"colorLambda",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"5%",stopColor:"#8b5cf6",stopOpacity:.8}),e.jsx("stop",{offset:"95%",stopColor:"#8b5cf6",stopOpacity:0})]})}),e.jsx(we,{strokeDasharray:"3 3",stroke:"#1e293b"}),e.jsx(_,{dataKey:"t",stroke:"#64748b",tick:{fontSize:12},tickFormatter:l=>l.toFixed(2)}),e.jsx(G,{stroke:"#64748b",tick:{fontSize:12}}),e.jsx(H,{contentStyle:{backgroundColor:"#0f172a",borderColor:"#1e293b"},itemStyle:{color:"#e2e8f0"},labelStyle:{color:"#94a3b8"},formatter:l=>[l.toFixed(4),"Prominence"],labelFormatter:l=>`t: ${Number(l).toFixed(2)}`}),e.jsx(Se,{type:"monotone",dataKey:"lambda",stroke:"#8b5cf6",fillOpacity:1,fill:"url(#colorLambda)"})]})})})})]}):e.jsxs(T,{className:"h-full bg-slate-900 border-slate-800",children:[e.jsx(F,{children:e.jsxs(z,{className:"flex items-center gap-2 text-slate-100",children:[e.jsx(W,{className:"w-5 h-5 text-primary"}),"Persistence Landscape"]})}),e.jsx(E,{className:"flex items-center justify-center h-[200px] text-slate-500",children:"Waiting for H1 features..."})]})}function ds(){const{analysisResult:s}=C(),{activeSourceIds:o,sourceStats:l}=K(),a=k.useMemo(()=>{if(o.size===0)return null;let r=0;Object.values(l).forEach(g=>r+=g.eps);const c=Math.random()*10-5,m=Math.min(95,Math.max(15,r/3+c));return{scores:{total:m,betti:m*.4,entropy:m*.3,ml:m*.3},topology_features:{entropy:2.5+m/100},is_anomaly:m>75}},[o,l]),i=s||a;if(!i||!i.scores)return e.jsxs(T,{className:"h-full bg-slate-900 border-slate-800",children:[e.jsx(F,{children:e.jsxs(z,{className:"flex items-center gap-2 text-slate-100",children:[e.jsx(D,{className:"w-5 h-5 text-primary"}),"Anomaly Score"]})}),e.jsx(E,{className:"flex items-center justify-center h-[200px] text-slate-500",children:o.size>0?"Analyzing stream...":"Waiting for data sources..."})]});const{scores:t,topology_features:n}=i,x=i.is_anomaly,p=r=>r<40?"bg-green-500":r<70?"bg-yellow-500":"bg-red-500",d=r=>r<40?"text-green-500":r<70?"text-yellow-500":"text-red-500";return e.jsxs(T,{className:h("h-full bg-slate-900 border-slate-800 transition-colors duration-500",x?"border-red-500/50 shadow-[0_0_20px_rgba(239,68,68,0.2)]":""),children:[e.jsx(F,{className:"pb-2",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs(z,{className:"flex items-center gap-2 text-slate-100",children:[e.jsx(D,{className:h("w-5 h-5",x?"text-red-500 animate-pulse":"text-primary")}),"Anomaly Score"]}),e.jsx("span",{className:h("text-2xl font-bold",d(t.total)),children:t.total.toFixed(1)})]})}),e.jsxs(E,{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(w,{value:t.total,className:"h-3 bg-slate-800",indicatorClassName:p(t.total)}),e.jsxs("div",{className:"flex justify-between text-xs text-slate-400",children:[e.jsx("span",{children:"Normal"}),e.jsx("span",{children:"Critical"})]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 pt-2",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-1.5 text-xs text-slate-400",children:[e.jsx(Ce,{className:"w-3.5 h-3.5"}),e.jsx("span",{children:"Structure"})]}),e.jsx("div",{className:"text-lg font-semibold text-slate-200",children:t.betti.toFixed(0)}),e.jsx(w,{value:t.betti,className:"h-1.5 bg-slate-800",indicatorClassName:"bg-blue-500"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-1.5 text-xs text-slate-400",children:[e.jsx(I,{className:"w-3.5 h-3.5"}),e.jsx("span",{children:"Entropy"})]}),e.jsx("div",{className:"text-lg font-semibold text-slate-200",children:t.entropy.toFixed(0)}),e.jsx(w,{value:t.entropy,className:"h-1.5 bg-slate-800",indicatorClassName:"bg-purple-500"}),e.jsxs("div",{className:"text-[10px] text-slate-500",children:[n==null?void 0:n.entropy.toFixed(2)," bits"]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-1.5 text-xs text-slate-400",children:[e.jsx(ke,{className:"w-3.5 h-3.5"}),e.jsx("span",{children:"ML Model"})]}),e.jsx("div",{className:"text-lg font-semibold text-slate-200",children:t.ml.toFixed(0)}),e.jsx(w,{value:t.ml,className:"h-1.5 bg-slate-800",indicatorClassName:"bg-orange-500"})]})]})]})]})}const ms=()=>{const{persistenceDiagram:s}=C();return e.jsx(ns,{data:s})},xs=()=>{const{persistenceDiagram:s}=C();return e.jsx(ls,{data:s})},us=()=>{const{persistenceDiagram:s}=C();return e.jsx(os,{data:s})};function ws(){const[s,o]=f.useState(["anomaly-score","landscape","feed","timeline","threats","topology"]),[l,a]=f.useState(!1),[i,t]=f.useState(!0),{toast:n}=Re(),{isSidebarCollapsed:x}=Me();f.useEffect(()=>{const u=setTimeout(()=>t(!1),1500);return()=>clearTimeout(u)},[]);const p=Ae(L(Pe),L(Le,{coordinateGetter:We})),d=u=>{const{active:N,over:b}=u;N.id!==b.id&&o(A=>{const q=A.indexOf(N.id),Z=A.indexOf(b.id);return Ie(A,q,Z)})},r=u=>{o(s.filter(N=>N!==u)),n({title:"Widget Removed",description:"The widget has been removed from your dashboard."})},c=u=>{s.includes(u)||(o([...s,u]),a(!1),n({title:"Widget Added",description:"The widget has been added to your dashboard."}))},m=u=>{const N=U.find(b=>b.id===u);return N?N.title:"Widget"},g=u=>{if(i)return e.jsx(ts,{});switch(u){case"feed":return e.jsx(Je,{className:"h-full"});case"timeline":return e.jsx(Qe,{});case"threats":return e.jsx(Ze,{});case"topology":return e.jsx(Ye,{});case"tda-stats":return e.jsx(is,{});case"barcode":return e.jsx(ms,{});case"birth-death":return e.jsx(xs,{});case"filtration":return e.jsx(us,{});case"landscape":return e.jsx(cs,{});case"anomaly-score":return e.jsx(ds,{});default:return null}},j=()=>{window.open(`${Be}/api/anomalies/export?format=csv`,"_blank"),n({title:"Export Started",description:"Downloading anomaly data as CSV..."})};return e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsx(Oe,{}),e.jsxs("main",{className:h("pt-20 pb-8 px-4 sm:px-6 lg:px-8 max-w-[1800px] mx-auto transition-all duration-300",x?"md:pl-[80px]":"md:pl-[280px]"),children:[e.jsxs("div",{className:"flex justify-between items-center mb-8",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Dashboard"}),e.jsx("p",{className:"text-muted-foreground text-sm mt-1",children:"Real-time monitoring and anomaly detection."})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(S,{variant:"outline",size:"sm",onClick:j,children:[e.jsx(De,{className:"w-4 h-4 mr-2"})," Export Data"]}),e.jsxs(S,{size:"sm",onClick:()=>a(!0),children:[e.jsx(M,{className:"w-4 h-4 mr-2"})," Add Widget"]})]})]}),e.jsx(Te,{sensors:p,collisionDetection:Fe,onDragEnd:d,children:e.jsx(ze,{items:s,strategy:Ee,children:e.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 gap-6 auto-rows-[400px]","data-tour":"dashboard-widgets",children:s.map(u=>e.jsx(es,{id:u,title:m(u),onRemove:r,className:h(u==="timeline"?"lg:col-span-2":"","stagger-item"),children:g(u)},u))})})}),e.jsx(ss,{open:l,onOpenChange:a,onAddWidget:c,activeWidgets:s}),e.jsx(as,{})]})]})}export{ws as default};
